var lt=Object.defineProperty,at=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var Se=(r,o,a)=>o in r?lt(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a,Te=(r,o)=>{for(var a in o||(o={}))ut.call(o,a)&&Se(r,a,o[a]);if($e)for(var a of $e(o))dt.call(o,a)&&Se(r,a,o[a]);return r},Me=(r,o)=>at(r,it(o));var H=(r,o,a)=>new Promise((c,b)=>{var w=x=>{try{L(a.next(x))}catch(k){b(k)}},S=x=>{try{L(a.throw(x))}catch(k){b(k)}},L=x=>x.done?c(x.value):Promise.resolve(x.value).then(w,S);L((a=a.apply(r,o)).next())});import{aL as Ie,aM as we,aN as ct,aO as mt,aP as Re,aQ as pt,aR as gt,c as q,r as E,G as vt,e as ae,y as g,z as A,o as v,ag as s,q as $,s as i,ak as U,ay as z,az as F,ae as G,F as J,A as ne,a4 as Oe,af as C,n as D,ao as V,aS as ht,aT as bt,aU as ft,aV as yt,aW as xt,aX as wt,aY as _t,aZ as kt,a_ as Ct,ad as M,aB as Et,a$ as $t,b0 as Ae,ac as St,aJ as be}from"./index-D6neGqae.js";function W(c,b){return H(this,arguments,function*(r,o,a={}){o||(o={});let w=Object.assign({Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-Frappe-Site-Name":window.location.hostname},a.headers||{});window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&(w["X-Frappe-CSRF-Token"]=window.csrf_token);let S=r.startsWith("/")?r:`/api/method/${r}`;const L=yield fetch(S,{method:"POST",headers:w,body:JSON.stringify(o)});if(L.ok){const x=yield L.json();if(x.docs||r==="login")return x;if(x.exc)try{console.groupCollapsed(r),console.log(`method: ${r}`),console.log("params:",o);let k=JSON.parse(x.exc);for(let I of k)console.log(I);console.groupEnd()}catch(k){console.warn("Error printing debug messages",k)}return x.message}else{let x=yield L.text(),k,I;try{k=JSON.parse(x)}catch(P){}let Q=[[r,k.exc_type,k._error_message].filter(Boolean).join(" ")];if(k.exc){I=k.exc;try{I=JSON.parse(I)[0],console.log(I)}catch(P){}}let T=new Error(Q.join(`
`));throw T.exc_type=k.exc_type,T.exc=I,T.status=L.status,T.messages=k._server_messages?JSON.parse(k._server_messages):[],T.messages=T.messages.concat(k.message),T.messages=T.messages.map(P=>{try{return JSON.parse(P).message}catch(X){return P}}),T.messages=T.messages.filter(Boolean),T.messages.length||(T.messages=k._error_message?[k._error_message]:["Internal Server Error"]),a.onError&&a.onError({response:L,status:L.status,error:T}),T}})}const Tt=Ie.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["u",we(this.options.HTMLAttributes,r),0]},addCommands(){return{setUnderline:()=>({commands:r})=>r.setMark(this.name),toggleUnderline:()=>({commands:r})=>r.toggleMark(this.name),unsetUnderline:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Mt=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,At=ct.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:r}){return["img",we(this.options.HTMLAttributes,r)]},addCommands(){return{setImage:r=>({commands:o})=>o.insertContent({type:this.name,attrs:r})}},addInputRules(){return[mt({find:Mt,type:this.type,getAttributes:r=>{const[,,o,a,c]=r;return{src:a,alt:o,title:c}}})]}}),R={MOBILE_BREAKPOINT:768,ICON_SIZE:"24px",CONTROLLER_HEIGHT:"25px",DOT_SIZE:{MOBILE:16,DESKTOP:9},DOT_POSITION:{MOBILE:"-8px",DESKTOP:"-4px"},COLORS:{BORDER:"#6C6C6C",BACKGROUND:"rgba(255, 255, 255, 1)"},ICONS:{LEFT:"https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_left/default/20px.svg",CENTER:"https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_center/default/20px.svg",RIGHT:"https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_right/default/20px.svg"}},oe={isMobile(){return document.documentElement.clientWidth<R.MOBILE_BREAKPOINT},getDotPosition(){return oe.isMobile()?R.DOT_POSITION.MOBILE:R.DOT_POSITION.DESKTOP},getDotSize(){return oe.isMobile()?R.DOT_SIZE.MOBILE:R.DOT_SIZE.DESKTOP},clearContainerBorder(r){const o=r.getAttribute("style"),a=o==null?void 0:o.replace("border: 1px dashed #6C6C6C;","").replace("border: 1px dashed rgb(108, 108, 108)","");r.setAttribute("style",a)},removeResizeElements(r){if(r.childElementCount>3)for(let o=0;o<5;o++)r.removeChild(r.lastChild)}};class me{static getContainerStyle(o,a){return`${`width: ${a||"100%"}; height: auto; cursor: pointer;`} ${o?"display: inline-block;":""}`}static getWrapperStyle(o){return o?"display: inline-block; float: left; padding-right: 8px;":"display: flex"}static getPositionControllerStyle(o){return`
      position: absolute; 
      top: 0%; 
      left: 50%; 
      width: ${o?"66px":"100px"}; 
      height: ${R.CONTROLLER_HEIGHT}; 
      z-index: 999; 
      background-color: ${R.COLORS.BACKGROUND}; 
      border-radius: 3px; 
      border: 1px solid ${R.COLORS.BORDER}; 
      cursor: pointer; 
      transform: translate(-50%, -50%); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 0 6px;
    `.replace(/\s+/g," ").trim()}static getDotStyle(o){const a=oe.getDotPosition(),c=oe.getDotSize(),b=[`top: ${a}; left: ${a}; cursor: nwse-resize;`,`top: ${a}; right: ${a}; cursor: nesw-resize;`,`bottom: ${a}; left: ${a}; cursor: nesw-resize;`,`bottom: ${a}; right: ${a}; cursor: nwse-resize;`];return`
      position: absolute; 
      width: ${c}px; 
      height: ${c}px; 
      border: 1.5px solid ${R.COLORS.BORDER}; 
      border-radius: 50%; 
      ${b[o]}
    `.replace(/\s+/g," ").trim()}}class Le{static parseImageAttributes(o,a){Object.entries(o).forEach(([c,b])=>{if(!(b==null||c==="wrapperStyle")){if(c==="containerStyle"){const w=b.match(/width:\s*([0-9.]+)px/);w&&a.setAttribute("width",w[1]);return}a.setAttribute(c,b)}})}static extractWidthFromStyle(o){const a=o.match(/width:\s*([0-9.]+)px/);return a?a[1]:null}}class Lt{constructor(o,a,c){this.elements=o,this.inline=a,this.dispatchNodeView=c}createControllerIcon(o){const a=document.createElement("img");return a.setAttribute("src",o),a.setAttribute("style",`width: ${R.ICON_SIZE}; height: ${R.ICON_SIZE}; cursor: pointer;`),a.addEventListener("mouseover",c=>{c.target.style.opacity="0.6"}),a.addEventListener("mouseout",c=>{c.target.style.opacity="1"}),a}handleLeftClick(){if(!this.inline)this.elements.container.setAttribute("style",`${this.elements.container.style.cssText} margin: 0 auto 0 0;`);else{const o="display: inline-block; float: left; padding-right: 8px;";this.elements.wrapper.setAttribute("style",o),this.elements.container.setAttribute("style",o)}this.dispatchNodeView()}handleCenterClick(){this.elements.container.setAttribute("style",`${this.elements.container.style.cssText} margin: 0 auto;`),this.dispatchNodeView()}handleRightClick(){if(!this.inline)this.elements.container.setAttribute("style",`${this.elements.container.style.cssText} margin: 0 0 0 auto;`);else{const o="display: inline-block; float: right; padding-left: 8px;";this.elements.wrapper.setAttribute("style",o),this.elements.container.setAttribute("style",o)}this.dispatchNodeView()}createPositionControls(){const o=document.createElement("div");o.setAttribute("style",me.getPositionControllerStyle(this.inline));const a=this.createControllerIcon(R.ICONS.LEFT);if(a.addEventListener("click",()=>this.handleLeftClick()),o.appendChild(a),!this.inline){const b=this.createControllerIcon(R.ICONS.CENTER);b.addEventListener("click",()=>this.handleCenterClick()),o.appendChild(b)}const c=this.createControllerIcon(R.ICONS.RIGHT);return c.addEventListener("click",()=>this.handleRightClick()),o.appendChild(c),this.elements.container.appendChild(o),this}}class It{constructor(o,a){this.state={isResizing:!1,startX:0,startWidth:0},this.handleMouseMove=(c,b)=>{if(!this.state.isResizing)return;const w=b%2===0?-(c.clientX-this.state.startX):c.clientX-this.state.startX,S=this.state.startWidth+w;this.elements.container.style.width=S+"px",this.elements.img.style.width=S+"px"},this.handleMouseUp=()=>{this.state.isResizing&&(this.state.isResizing=!1),this.dispatchNodeView()},this.handleTouchMove=(c,b)=>{if(!this.state.isResizing)return;const w=b%2===0?-(c.touches[0].clientX-this.state.startX):c.touches[0].clientX-this.state.startX,S=this.state.startWidth+w;this.elements.container.style.width=S+"px",this.elements.img.style.width=S+"px"},this.handleTouchEnd=()=>{this.state.isResizing&&(this.state.isResizing=!1),this.dispatchNodeView()},this.elements=o,this.dispatchNodeView=a}createResizeHandle(o){const a=document.createElement("div");return a.setAttribute("style",me.getDotStyle(o)),a.addEventListener("mousedown",c=>{c.preventDefault(),this.state.isResizing=!0,this.state.startX=c.clientX,this.state.startWidth=this.elements.container.offsetWidth;const b=S=>this.handleMouseMove(S,o),w=()=>{this.handleMouseUp(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",w)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",w)}),a.addEventListener("touchstart",c=>{c.cancelable&&c.preventDefault(),this.state.isResizing=!0,this.state.startX=c.touches[0].clientX,this.state.startWidth=this.elements.container.offsetWidth;const b=S=>this.handleTouchMove(S,o),w=()=>{this.handleTouchEnd(),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",w)};document.addEventListener("touchmove",b),document.addEventListener("touchend",w)},{passive:!1}),a}}class Rt{constructor(o,a){this.clearContainerBorder=()=>{oe.clearContainerBorder(this.elements.container)},this.dispatchNodeView=()=>{var c;const{view:b,getPos:w}=this.context;if(typeof w=="function"){this.clearContainerBorder();const S=Object.assign(Object.assign({},this.context.node.attrs),{width:(c=Le.extractWidthFromStyle(this.elements.container.style.cssText))!==null&&c!==void 0?c:this.context.node.attrs.width,containerStyle:`${this.elements.container.style.cssText}`,wrapperStyle:`${this.elements.wrapper.style.cssText}`});b.dispatch(b.state.tr.setNodeMarkup(w(),null,S))}},this.removeResizeElements=()=>{oe.removeResizeElements(this.elements.container)},this.context=o,this.inline=a,this.elements=this.createElements()}createElements(){return{wrapper:document.createElement("div"),container:document.createElement("div"),img:document.createElement("img")}}setupImageAttributes(){Le.parseImageAttributes(this.context.node.attrs,this.elements.img)}setupDOMStructure(){const{wrapperStyle:o,containerStyle:a}=this.context.node.attrs;this.elements.wrapper.setAttribute("style",o),this.elements.wrapper.appendChild(this.elements.container),this.elements.container.setAttribute("style",a),this.elements.container.appendChild(this.elements.img)}createPositionController(){new Lt(this.elements,this.inline,this.dispatchNodeView).createPositionControls()}createResizeHandler(){const o=new It(this.elements,this.dispatchNodeView);Array.from({length:4},(a,c)=>{const b=o.createResizeHandle(c);this.elements.container.appendChild(b)})}setupContainerClick(){this.elements.container.addEventListener("click",()=>{var o;oe.isMobile()&&((o=document.querySelector(".ProseMirror-focused"))===null||o===void 0||o.blur()),this.removeResizeElements(),this.createPositionController(),this.elements.container.setAttribute("style",`position: relative; border: 1px dashed ${R.COLORS.BORDER}; ${this.context.node.attrs.containerStyle}`),this.createResizeHandler()})}setupContentClick(){document.addEventListener("click",o=>{const a=o.target;this.elements.container.contains(a)||a.style.cssText===`width: ${R.ICON_SIZE}; height: ${R.ICON_SIZE}; cursor: pointer;`||(this.clearContainerBorder(),this.removeResizeElements())})}initialize(){this.setupDOMStructure(),this.setupImageAttributes();const{editable:o}=this.context.editor.options;return o?(this.setupContainerClick(),this.setupContentClick(),{dom:this.elements.wrapper}):{dom:this.elements.container}}}const Ot=At.extend({name:"imageResize",addOptions(){var r;return Object.assign(Object.assign({},(r=this.parent)===null||r===void 0?void 0:r.call(this)),{inline:!1})},addAttributes(){var r;const o=this.options.inline;return Object.assign(Object.assign({},(r=this.parent)===null||r===void 0?void 0:r.call(this)),{containerStyle:{default:me.getContainerStyle(o),parseHTML:a=>{const c=a.getAttribute("containerstyle")||a.getAttribute("style");if(c)return c;const b=a.getAttribute("width");return b?me.getContainerStyle(o,`${b}px`):`${a.style.cssText}`}},wrapperStyle:{default:me.getWrapperStyle(o)}})},addNodeView(){return({node:r,editor:o,getPos:a})=>{const c=this.options.inline,b={node:r,editor:o,view:o.view,getPos:typeof a=="function"?a:void 0};return new Rt(b,c).initialize()}}}),Nt=Re.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:r=>{var o;return(o=r.style.color)===null||o===void 0?void 0:o.replace(/['"]+/g,"")},renderHTML:r=>r.color?{style:`color: ${r.color}`}:{}}}}]},addCommands(){return{setColor:r=>({chain:o})=>o().setMark("textStyle",{color:r}).run(),unsetColor:()=>({chain:r})=>r().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),jt=Re.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:r=>r.style.fontFamily,renderHTML:r=>r.fontFamily?{style:`font-family: ${r.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:r=>({chain:o})=>o().setMark("textStyle",{fontFamily:r}).run(),unsetFontFamily:()=>({chain:r})=>r().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),Gt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,Ht=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,zt=Ie.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:r=>r.getAttribute("data-color")||r.style.backgroundColor,renderHTML:r=>r.color?{"data-color":r.color,style:`background-color: ${r.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:r}){return["mark",we(this.options.HTMLAttributes,r),0]},addCommands(){return{setHighlight:r=>({commands:o})=>o.setMark(this.name,r),toggleHighlight:r=>({commands:o})=>o.toggleMark(this.name,r),unsetHighlight:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[gt({find:Gt,type:this.type})]},addPasteRules(){return[pt({find:Ht,type:this.type})]}}),Dt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ut={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden"},Bt={class:"flex items-center justify-between p-6 border-b border-gray-200"},Ft={class:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]"},Pt={class:"space-y-4"},Vt={class:"relative"},Wt={class:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg"},Xt={key:0,class:"p-8 text-center"},Kt={key:1,class:"p-8 text-center text-gray-500"},qt={key:2,class:"divide-y divide-gray-200"},Zt=["onClick"],Jt={class:"flex items-center justify-between"},Qt={class:"flex items-center space-x-3"},Yt=["checked","onChange"],es={class:"font-medium text-gray-900"},ts={class:"text-sm text-gray-500"},ss={key:0,class:"text-xs text-gray-400 mt-1"},ns={class:"text-right"},os={class:"text-sm text-gray-500"},rs={key:0,class:"text-xs text-gray-400"},ls={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},as={class:"font-medium text-blue-900 mb-2"},is={class:"space-y-1"},us={class:"text-blue-800"},ds={class:"text-blue-600"},cs={class:"mt-2 pt-2 border-t border-blue-200"},ms={class:"font-medium text-blue-900"},ps={class:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50"},gs={__name:"GroupSelectorDialog",props:{show:{type:Boolean,default:!1}},emits:["update:show","groups-selected"],setup(r,{emit:o}){const a=r,c=o,b=q({get:()=>a.show,set:y=>c("update:show",y)}),w=E(""),S=E(!1),L=E([]),x=E([]),k=E({}),I=q(()=>{if(!w.value)return L.value;const y=w.value.toLowerCase();return L.value.filter(p=>p.name.toLowerCase().includes(y)||p.description&&p.description.toLowerCase().includes(y))}),Q=q(()=>x.value.reduce((y,p)=>y+(p.email_count||0),0)),T=()=>H(this,null,function*(){S.value=!0;try{console.log("Loading email groups from Frappe...");const y=yield W("frappe.client.get_list",{doctype:"Email Group",fields:["name","title","total_subscribers","creation","modified"],filters:[["title","not like","temp-grp-%"]],order_by:"modified desc",limit_page_length:100});console.log("Email Groups loaded:",y),L.value=y.map(p=>({name:p.name,title:p.title||p.name,email_count:p.total_subscribers||0,description:"",creation:p.creation,modified:p.modified,emails:[]}))}catch(y){console.error("Error loading email groups:",y),L.value=[]}finally{S.value=!1}}),P=y=>H(this,null,function*(){if(k.value[y])return k.value[y];try{console.log("Loading members for group:",y);const _=(yield W("frappe.client.get_list",{doctype:"Email Group Member",fields:["email","email_group"],filters:[["email_group","=",y]],limit_page_length:1e3})).map(Y=>Y.email);return k.value[y]=_,_}catch(p){return console.error("Error loading group members:",p),[]}}),X=y=>x.value.some(p=>p.name===y.name),d=y=>H(this,null,function*(){const p=x.value.findIndex(_=>_.name===y.name);if(p>-1)x.value.splice(p,1);else{const _=yield P(y.name);x.value.push(Me(Te({},y),{emails:_}))}}),fe=()=>{c("groups-selected",[...x.value]),re()},re=()=>{b.value=!1,x.value=[],w.value=""},pe=y=>{if(!y)return"N/A";try{return new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(p){return"Invalid Date"}};return vt(()=>{a.show&&T()}),ae(()=>a.show,y=>{y&&T()}),(y,p)=>b.value?(v(),g("div",Dt,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:re}),s("div",Ut,[s("div",Bt,[p[2]||(p[2]=s("h2",{class:"text-lg font-semibold text-gray-900"},"Select Email Groups",-1)),s("button",{onClick:re,class:"text-gray-400 hover:text-gray-600"},[$(i(U),{name:"x",class:"w-5 h-5"})])]),s("div",Ft,[s("div",Pt,[s("div",Vt,[$(i(U),{name:"search",class:"w-4 h-4 text-gray-400 absolute left-3 top-3"}),z(s("input",{"onUpdate:modelValue":p[0]||(p[0]=_=>w.value=_),type:"text",placeholder:"Search email groups...",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[F,w.value]])]),s("div",Wt,[S.value?(v(),g("div",Xt,[...p[3]||(p[3]=[s("div",{class:"flex items-center justify-center"},[s("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500 mr-2"}),G(" Loading email groups... ")],-1)])])):I.value.length===0?(v(),g("div",Kt,[$(i(U),{name:"inbox",class:"w-8 h-8 mx-auto mb-2 text-gray-300"}),p[4]||(p[4]=s("p",null,"No email groups found",-1)),p[5]||(p[5]=s("p",{class:"text-xs mt-1"},"Create email groups in the system to see them here",-1))])):(v(),g("div",qt,[(v(!0),g(J,null,ne(I.value,_=>(v(),g("div",{key:_.name,class:"p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:Y=>d(_)},[s("div",Jt,[s("div",Qt,[s("input",{type:"checkbox",checked:X(_),onChange:Y=>d(_),onClick:p[1]||(p[1]=Oe(()=>{},["stop"])),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"},null,40,Yt),s("div",null,[s("div",es,C(_.title||_.name),1),s("div",ts,C(_.email_count||0)+" recipients ",1),_.description?(v(),g("div",ss,C(_.description),1)):A("",!0)])]),s("div",ns,[s("div",os," Created: "+C(pe(_.creation)),1),_.modified!==_.creation?(v(),g("div",rs," Modified: "+C(pe(_.modified)),1)):A("",!0)])])],8,Zt))),128))]))]),x.value.length>0?(v(),g("div",ls,[s("h4",as,"Selected Groups ("+C(x.value.length)+")",1),s("div",is,[(v(!0),g(J,null,ne(x.value,_=>(v(),g("div",{key:_.name,class:"flex items-center justify-between text-sm"},[s("span",us,C(_.title||_.name),1),s("span",ds,C(_.email_count||0)+" recipients",1)]))),128))]),s("div",cs,[s("span",ms," Total Recipients: "+C(Q.value),1)])])):A("",!0)])]),s("div",ps,[$(i(V),{onClick:re,variant:"outline"},{default:D(()=>[...p[6]||(p[6]=[G(" Cancel ",-1)])]),_:1}),$(i(V),{onClick:fe,variant:"solid"},{default:D(()=>[...p[7]||(p[7]=[G(" Done ",-1)])]),_:1})])])])):A("",!0)}},vs={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},hs={class:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden"},bs={class:"flex items-center justify-between p-6 border-b border-gray-200"},fs={class:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]"},ys={class:"space-y-6"},xs={class:"flex items-start space-x-2"},ws={class:"flex-1"},_s={class:"w-full min-h-[80px] px-3 py-2 border border-gray-300 rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500"},ks={class:"flex flex-wrap gap-2 mb-2"},Cs=["onClick"],Es={class:"font-medium"},$s={class:"text-xs text-blue-600"},Ss=["onClick"],Ts={key:0,class:"absolute z-20 mt-1 p-3 bg-white border border-gray-300 rounded-lg shadow-lg max-w-xs"},Ms={class:"flex items-center justify-between mb-2"},As={class:"text-sm font-semibold text-gray-700"},Ls=["onClick"],Is={class:"max-h-40 overflow-y-auto space-y-1"},Rs={key:0,class:"text-xs text-gray-400 italic"},Os=["title"],Ns={key:0,class:"text-red-600"},js={key:1,class:"text-yellow-600"},Gs={key:2,class:"text-green-600"},Hs=["onClick"],zs={class:"text-xs text-gray-500 mt-1"},Ds={key:0,class:"border border-gray-300 rounded-lg overflow-hidden"},Us={key:0,class:"bg-gray-50 p-2 border-b border-gray-300"},Bs={class:"flex flex-wrap gap-1 mb-2"},Fs={class:"relative inline-block"},Ps={key:0,class:"absolute z-10 mt-1 p-2 bg-white border border-gray-300 rounded shadow-lg"},Vs={class:"relative inline-block"},Ws={key:0,class:"absolute z-10 mt-1 p-2 bg-white border border-gray-300 rounded shadow-lg"},Xs={class:"flex flex-wrap gap-1 mb-2"},Ks={class:"flex flex-wrap gap-1"},qs=["disabled"],Zs=["disabled"],Js={key:1},Qs={key:2},Ys={class:"border border-gray-300 rounded-lg p-4 bg-gray-50"},en={key:0,class:"flex flex-wrap gap-2 mb-3"},tn={class:"flex-shrink-0"},sn={key:0,class:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},nn={key:1,class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},on={key:2,class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},rn={class:"flex-1 min-w-0"},ln={class:"font-medium text-gray-900 truncate"},an={class:"text-xs text-gray-500"},un=["onClick"],dn={class:"flex items-center gap-2"},cn={key:0,class:"text-xs text-gray-500"},mn={class:"bg-gray-50 p-4 rounded-lg"},pn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gn={class:"space-y-3"},vn={class:"flex items-center"},hn={class:"space-y-3"},bn={class:"flex items-center"},fn={key:0},yn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xn={key:0},wn={class:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50"},_n={class:"flex items-center space-x-3"},kn={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Cn={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},En={class:"flex items-center justify-between p-6 border-b border-gray-200"},$n={class:"p-6"},Sn={class:"text-sm text-gray-600 mb-4"},Tn={class:"mb-4"},Mn={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},An={class:"text-xs text-blue-800 space-y-1 max-h-32 overflow-y-auto"},Ln={class:"mt-2 pt-2 border-t border-blue-200 text-sm font-medium text-blue-900"},In={class:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50"},Rn=10*1024*1024,jn={__name:"ComposeEmailDialog",props:{show:{type:Boolean,default:!1}},emits:["update:show","email-sent"],setup(r,{emit:o}){const a=r,c=o,b=q({get:()=>a.show,set:n=>c("update:show",n)}),w=E(!1),S=E(!1),L=E(!1),x=E(!1),k=E(!1),I=E(""),Q=E(null),T=E([]),P=E(""),X=E(null),d=ht({extensions:[bt,Tt,Ot.configure({inline:!0,allowBase64:!0}),ft.configure({types:["heading","paragraph"],defaultAlignment:"left"}),yt,Nt,jt,zt.configure({multicolor:!0}),xt.configure({resizable:!0}),wt,_t,kt],content:"",editorProps:{attributes:{class:"w-full px-3 py-2 focus:outline-none min-h-[200px] max-h-[400px] overflow-y-auto prose prose-sm max-w-none",style:"text-align: left;"}},onUpdate:({editor:n})=>{l.value.message=n.getHTML()}}),fe=E(null),re=()=>{const n=prompt("Enter image URL (or paste base64 data URI):");n&&d.value.chain().focus().setImage({src:n}).run()},pe=n=>{const e=n.target.files[0];if(e&&e.type.startsWith("image/")){const t=new FileReader;t.onload=u=>{d.value.chain().focus().setImage({src:u.target.result}).run()},t.readAsDataURL(e)}},y=E(!1),p=E(!1),_=E("#000000"),Y=E("#ffff00"),Ne=n=>{d.value.chain().focus().setColor(n).run(),y.value=!1},je=n=>{d.value.chain().focus().toggleHighlight({color:n}).run(),p.value=!1},Ge=()=>{d.value.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},He=E(null),Z=E(""),B=E([]),O=E([]),ee=E([]),ye=E(null),N=E([]),ze=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.trim()),De=n=>{const e=n.trim();if(!e)return"Email cannot be empty";if(!e.includes("@"))return"Email must contain @ symbol";const t=e.split("@");return t.length!==2?"Email must have exactly one @ symbol":t[0]?t[1]?t[1].includes(".")?t[1].split(".").some(m=>!m)?"Domain parts cannot be empty":/\s/.test(e)?"Email cannot contain spaces":"Invalid email format":"Domain must contain a dot (.)":"Email must have a domain after @":"Email must have a username before @"},Ue=n=>{const e=n.toLowerCase().trim();if(B.value.findIndex(u=>u.address.toLowerCase()===e)>-1)return"Already added manually";for(const u of O.value)if(u.emails&&u.emails.some(m=>m.toLowerCase()===e))return`Already in group: ${u.name}`;return null},xe=n=>{const e=n.trim();if(!e)return;let t="valid",u="";if(!ze(e))t="invalid",u=De(e);else{const m=Ue(e);m&&(t="duplicate",u=m)}B.value.push({address:e,status:t,reason:u}),Z.value=""},Be=n=>{B.value.splice(n,1)},Fe=n=>{n.key===","||n.key==="Enter"?(n.preventDefault(),xe(Z.value)):n.key==="Backspace"&&Z.value===""&&B.value.length>0&&B.value.pop()},Pe=n=>{var u;n.preventDefault(),(((u=n.clipboardData)==null?void 0:u.getData("text"))||"").split(/[,;\s\n]+/).filter(m=>m.trim()).forEach(m=>{xe(m)})},Ve=()=>{Z.value.trim()&&xe(Z.value)},_e=n=>{const e=ee.value.indexOf(n);e>-1?ee.value.splice(e,1):ee.value.push(n)},We=n=>{const e=O.value.findIndex(t=>t.name===n);if(e>-1){O.value.splice(e,1);const t=ee.value.indexOf(n);t>-1&&ee.value.splice(t,1)}l.value.email_group=O.value.map(t=>({email_group:t.name}))},Xe=n=>{Array.from(n.target.files||[]).forEach(t=>{if(t.size>Rn){alert(`File "${t.name}" is too large. Maximum size is 10MB.`);return}if(N.value.some(m=>m.name===t.name&&m.size===t.size)){alert(`File "${t.name}" is already attached.`);return}N.value.push(t)}),ye.value&&(ye.value.value="")},Ke=n=>{N.value.splice(n,1)},ke=n=>{if(n===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(n)/Math.log(e));return Math.round(n/Math.pow(e,u)*100)/100+" "+t[u]},qe=n=>n.type.startsWith("image/"),Ze=n=>n.type==="application/pdf"||n.name.toLowerCase().endsWith(".pdf"),Je=q(()=>N.value.reduce((n,e)=>n+e.size,0)),ge=()=>`temp-grp-${Math.random().toString(36).substring(2,8)}`,ve=(n,e,t=!1)=>H(this,null,function*(){try{console.log(`Creating email group: ${n}`,e);const m=yield W("frappe.client.insert",{doc:{doctype:"Email Group",title:n}});console.log("Email Group created:",m);for(const f of e){const h={doctype:"Email Group Member",email_group:m.name,email:f,unsubscribed:0};yield W("frappe.client.insert",{doc:h})}return console.log(`Added ${e.length} members to group ${n}`),{name:m.name,title:n,email_count:e.length,emails:e,isTemporary:t}}catch(u){throw console.error("Error creating email group:",u),new Error(`Failed to create email group: ${u.message||u}`)}}),Ce=(n,e,t)=>{T.value=n,P.value=e,X.value=t,I.value="",k.value=!0,setTimeout(()=>{Q.value&&Q.value.focus()},100)},ie=()=>{k.value=!1,T.value=[],P.value="",X.value=null,I.value=""},Qe=()=>H(this,null,function*(){if(k.value=!1,X.value){const n=ge(),e=yield ve(n,T.value,!0);X.value(e)}ie()}),Ee=()=>H(this,null,function*(){if(k.value=!1,X.value){const n=I.value.trim()||ge(),e=!I.value.trim(),t=yield ve(n,T.value,e);X.value(t)}ie()}),l=E({sender_name:"",sender_email:"",send_from:"",email_group:[],subject:"",content_type:"Rich Text",message:"",message_md:"",message_html:"",send_unsubscribe_link:!0,send_webview_link:!1,published:!1,route:"",schedule_sending:!1,schedule_send:"",campaign:"",attachments:[]}),he=q(()=>B.value.filter(n=>n.status==="valid").length),Ye=q(()=>B.value.filter(n=>n.status==="invalid").length),et=q(()=>B.value.filter(n=>n.status==="duplicate").length),ue=q(()=>{const n=O.value.reduce((t,u)=>t+(u.email_count||0),0),e=he.value;return n+e});ae(()=>l.value.content_type,(n,e)=>{n!=="Rich Text"&&(l.value.message=""),n!=="Markdown"&&(l.value.message_md=""),n!=="HTML"&&(l.value.message_html="")}),ae(()=>l.value.message,n=>{d.value&&d.value.getHTML()!==n&&d.value.commands.setContent(n||"",!1)}),ae(x,n=>{l.value.schedule_sending=n,n||(l.value.schedule_send="")}),ae(()=>l.value.published,n=>{n&&l.value.subject&&!l.value.route?l.value.route=`newsletter/${l.value.subject.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}`:n||(l.value.route="")});const de=()=>{c("close"),b.value=!1},tt=()=>{const n=be.user||"Administrator";console.log("Resetting form for user:",n),console.log("Session object:",be);let e=n.includes("@")?n:`${n}@yourcompany.com`,t=n==="Administrator"?"System Administrator":n;console.log("Default sender email:",e),console.log("Default sender name:",t),l.value={sender_name:t,sender_email:e,send_from:t,email_group:[],subject:"",content_type:"Rich Text",message:"",message_md:"",message_html:"",send_unsubscribe_link:!0,send_webview_link:!1,published:!1,route:"",schedule_sending:!1,schedule_send:"",campaign:"",attachments:[]},console.log("Form initialized with sender_email:",l.value.sender_email),W("frappe.client.get",{doctype:"User",name:n}).then(u=>{if(console.log("Fetched user document:",u),u&&u.email){const m=u.email,f=u.full_name||u.first_name||n;console.log("Updating sender email to:",m),console.log("Updating sender name to:",f),m&&m.includes("@")?(l.value.sender_email=m,l.value.sender_name=f,l.value.send_from=f,console.log("Updated form sender_email:",l.value.sender_email)):console.warn("User document email is invalid, keeping default:",m)}else console.warn("User document missing email field, keeping default")}).catch(u=>{console.error("Error fetching user email:",u),console.log("Keeping default sender email:",l.value.sender_email)}),B.value=[],Z.value="",O.value=[],ee.value=[],x.value=!1,N.value=[],d.value&&d.value.commands.setContent("",!1)},st=n=>{O.value=n,l.value.email_group=n.map(e=>({email_group:e.name}))},nt=()=>H(this,null,function*(){const n=e=>H(this,null,function*(){try{S.value=!0;const t=[];if(N.value.length>0){console.log(`Uploading ${N.value.length} attachments...`);for(const f of N.value)try{const h=new FormData;h.append("file",f,f.name),h.append("is_private","0");const le=(se=>{const ce=`; ${document.cookie}`.split(`; ${se}=`);return ce.length===2?ce.pop().split(";").shift():null})("csrf_token"),K=yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":le},body:h});if(!K.ok){const se=yield K.text();throw console.error("Upload error response:",se),new Error(`Upload failed with status ${K.status}`)}const te=yield K.json();if(te.message)console.log("File uploaded:",te.message),t.push({attachment:te.message.file_url});else throw new Error("Upload response missing file_url")}catch(h){throw console.error("Error uploading file:",f.name,h),new Error(`Failed to upload file "${f.name}": ${h.message||h}`)}console.log("All attachments uploaded successfully:",t)}const u={doctype:"Newsletter",subject:l.value.subject,sender_name:l.value.sender_name||be.user,sender_email:l.value.sender_email,send_from:l.value.send_from||`${l.value.sender_name} <${l.value.sender_email}>`,content_type:l.value.content_type,message:l.value.message||"",message_md:l.value.message_md||"",message_html:l.value.message_html||"",send_unsubscribe_link:l.value.send_unsubscribe_link?1:0,send_webview_link:l.value.send_webview_link?1:0,published:l.value.published?1:0,route:l.value.route||"",schedule_sending:l.value.schedule_sending?1:0,schedule_send:l.value.schedule_send||null,campaign:l.value.campaign||"",email_group:e.map(f=>({email_group:f.name})),attachments:t};console.log("Saving Newsletter draft:",u);const m=yield W("frappe.client.insert",{doc:u});console.log("Newsletter saved:",m),c("email-sent",{type:"success",subject:m.subject,name:m.name,recipientCount:ue.value,action:"draft_saved",message:`Newsletter draft "${m.subject}" saved successfully!`}),de()}catch(t){console.error("Error saving newsletter:",t),c("email-sent",{type:"error",subject:l.value.subject,name:null,recipientCount:0,action:"draft_save_failed",message:`Failed to save newsletter: ${t.message||t}`})}finally{S.value=!1}});try{if(!l.value.subject)throw new Error("Subject is required");if(!l.value.sender_email)throw new Error("Sender Email is required");if(O.value.length===0&&he.value===0)throw new Error("At least one email group or recipient is required");const e=B.value.filter(h=>h.status==="valid").map(h=>h.address),t=O.value.length>0,u=e.length>0;if(t&&!u){yield n(O.value);return}if(!t&&e.length===1){const h=ge(),j=yield ve(h,e,!0);yield n([j]);return}let m=[...e],f="";t&&u?(O.value.forEach(h=>{h.emails&&m.push(...h.emails)}),m=[...new Set(m)],f="You have selected email groups and added individual emails. Would you like to save all recipients as a new group for future use?"):f="Would you like to save these recipients as a group for future use?",Ce(m,f,h=>H(this,null,function*(){yield n(t?[h]:[h])}))}catch(e){console.error("Error in save draft:",e),alert(`Error: ${e.message||e}`),S.value=!1}}),ot=()=>H(this,null,function*(){const n=e=>H(this,null,function*(){try{w.value=!0;const t=[];if(N.value.length>0){console.log(`Uploading ${N.value.length} attachments...`);for(const f of N.value)try{const h=new FormData;h.append("file",f,f.name),h.append("is_private","0");const le=(se=>{const ce=`; ${document.cookie}`.split(`; ${se}=`);return ce.length===2?ce.pop().split(";").shift():null})("csrf_token"),K=yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":le},body:h});if(!K.ok){const se=yield K.text();throw console.error("Upload error response:",se),new Error(`Upload failed with status ${K.status}`)}const te=yield K.json();if(te.message)console.log("File uploaded:",te.message),t.push({attachment:te.message.file_url});else throw new Error("Upload response missing file_url")}catch(h){throw console.error("Error uploading file:",f.name,h),new Error(`Failed to upload file "${f.name}": ${h.message||h}`)}console.log("All attachments uploaded successfully:",t)}const u={doctype:"Newsletter",subject:l.value.subject,sender_name:l.value.sender_name||be.user,sender_email:l.value.sender_email,send_from:l.value.send_from||`${l.value.sender_name} <${l.value.sender_email}>`,content_type:l.value.content_type,message:l.value.message||"",message_md:l.value.message_md||"",message_html:l.value.message_html||"",send_unsubscribe_link:l.value.send_unsubscribe_link?1:0,send_webview_link:l.value.send_webview_link?1:0,published:l.value.published?1:0,route:l.value.route||"",schedule_sending:l.value.schedule_sending?1:0,schedule_send:l.value.schedule_send||null,campaign:l.value.campaign||"",email_group:e.map(f=>({email_group:f.name})),attachments:t};console.log("Creating Newsletter:",u);let m;try{m=yield W("frappe.client.insert",{doc:u})}catch(f){if(f.message&&f.message.includes("DuplicateEntryError")){const h=Date.now();u.subject=`${l.value.subject} (${h})`,m=yield W("frappe.client.insert",{doc:u})}else throw f}console.log("Newsletter saved:",m),console.log("Email groups in newsletter:",e.map(f=>f.name));for(const f of e){console.log(`Checking members for group: ${f.name}`);try{const h=yield W("frappe.client.get_list",{doctype:"Email Group Member",fields:["email","email_group","unsubscribed"],filters:[["email_group","=",f.name]],limit_page_length:1e3});console.log(`Group ${f.name} has ${h.length} members:`,h)}catch(h){console.error(`Error checking members for ${f.name}:`,h)}}l.value.schedule_sending&&l.value.schedule_send?c("email-sent",{type:"info",subject:m.subject,name:m.name,recipientCount:ue.value,scheduled:!0,action:"scheduled",message:`Newsletter "${m.subject}" scheduled to send at ${l.value.schedule_send}`}):(console.log("Sending newsletter:",m.name),yield W("run_doc_method",{docs:m,method:"send_emails"}),c("email-sent",{type:"success",subject:m.subject,name:m.name,recipientCount:ue.value,scheduled:!1,action:"sent",message:`Newsletter "${m.subject}" has been queued for sending to ${ue.value} recipients!`})),de()}catch(t){console.error("Error sending newsletter:",t),c("email-sent",{type:"error",subject:l.value.subject,name:null,recipientCount:0,scheduled:!1,action:"send_failed",message:`Failed to send newsletter: ${t.message||t}`})}finally{w.value=!1}});try{if(!l.value.subject)throw new Error("Subject is required");if(!l.value.sender_email)throw console.error("Sender email is missing! Current formData:",l.value),new Error("Sender Email is required");console.log("Sending email with sender:",l.value.sender_email);const e={"Rich Text":"message",Markdown:"message_md",HTML:"message_html"}[l.value.content_type];if(!l.value[e])throw new Error("Message content is required");if(O.value.length===0&&he.value===0)throw new Error("At least one email group or recipient is required");const t=B.value.filter(j=>j.status==="valid").map(j=>j.address),u=O.value.length>0,m=t.length>0;if(u&&!m){yield n(O.value);return}if(!u&&t.length===1){const j=ge(),le=yield ve(j,t,!0);yield n([le]);return}let f=[...t],h="";u&&m?(O.value.forEach(j=>{j.emails&&f.push(...j.emails)}),f=[...new Set(f)],h="You have selected email groups and added individual emails. Would you like to save all recipients as a new group for future use?"):h="Would you like to save these recipients as a group for future use?",Ce(f,h,j=>H(this,null,function*(){yield n(u?[j]:[j])}))}catch(e){console.error("Error in send email:",e),alert(`Error: ${e.message||e}`),w.value=!1}});return ae(()=>a.show,n=>{n&&tt()}),Ct(()=>{d.value&&d.value.destroy()}),(n,e)=>(v(),g(J,null,[b.value?(v(),g("div",vs,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:de}),s("div",hs,[s("div",bs,[e[42]||(e[42]=s("h2",{class:"text-lg font-semibold text-gray-900"},"Compose Email",-1)),s("button",{onClick:de,class:"text-gray-400 hover:text-gray-600"},[$(i(U),{name:"x",class:"w-5 h-5"})])]),s("div",fs,[s("div",ys,[s("div",null,[e[44]||(e[44]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[G("Recipients "),s("span",{class:"text-red-500"},"*")],-1)),s("div",xs,[s("div",ws,[s("div",_s,[s("div",ks,[(v(!0),g(J,null,ne(O.value,t=>(v(),g("div",{key:"group-"+t.name,class:"relative group"},[s("div",{class:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors",onClick:u=>_e(t.name)},[$(i(U),{name:"users",class:"w-3 h-3"}),s("span",Es,C(t.title||t.name),1),s("span",$s,"("+C(t.email_count||0)+")",1),s("button",{type:"button",onClick:Oe(u=>We(t.name),["stop"]),class:"ml-1 hover:bg-blue-300 rounded-full p-0.5"},[$(i(U),{name:"x",class:"w-3 h-3"})],8,Ss)],8,Cs),ee.value.includes(t.name)?(v(),g("div",Ts,[s("div",Ms,[s("h4",As,C(t.title||t.name)+" Members",1),s("button",{type:"button",onClick:u=>_e(t.name),class:"text-gray-400 hover:text-gray-600"},[$(i(U),{name:"x",class:"w-4 h-4"})],8,Ls)]),s("div",Is,[(v(!0),g(J,null,ne(t.emails||[],(u,m)=>(v(),g("div",{key:m,class:"text-xs text-gray-600 py-1 px-2 bg-gray-50 rounded"},C(u),1))),128)),!t.emails||t.emails.length===0?(v(),g("div",Rs," No members loaded ")):A("",!0)])])):A("",!0)]))),128)),(v(!0),g(J,null,ne(B.value,(t,u)=>(v(),g("div",{key:"email-"+u,class:M(["inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm relative group",t.status==="valid"?"bg-green-100 text-green-800":t.status==="invalid"?"bg-red-100 text-red-800":t.status==="duplicate"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"]),title:t.reason||""},[t.status==="invalid"?(v(),g("span",Ns,"⚠️")):A("",!0),t.status==="duplicate"?(v(),g("span",js,"⚠")):A("",!0),t.status==="valid"?(v(),g("span",Gs,"✓")):A("",!0),s("span",null,C(t.address),1),s("button",{type:"button",onClick:m=>Be(u),class:M(["hover:bg-opacity-50 rounded-full p-0.5",t.status==="valid"?"hover:bg-green-300":t.status==="invalid"?"hover:bg-red-300":t.status==="duplicate"?"hover:bg-yellow-300":"hover:bg-gray-300"])},[$(i(U),{name:"x",class:"w-3 h-3"})],10,Hs),t.reason?(v(),g("div",{key:3,class:M(["absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-xs text-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-30",[t.status==="invalid"?"bg-red-600":t.status==="duplicate"?"bg-yellow-600":"bg-gray-600"]])},[G(C(t.reason)+" ",1),s("div",{class:M(["absolute top-full left-1/2 -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent",[t.status==="invalid"?"border-t-red-600":t.status==="duplicate"?"border-t-yellow-600":"border-t-gray-600"]])},null,2)],2)):A("",!0)],10,Os))),128))]),z(s("input",{ref_key:"recipientInput",ref:He,"onUpdate:modelValue":e[0]||(e[0]=t=>Z.value=t),onKeydown:Fe,onPaste:Pe,onBlur:Ve,type:"text",placeholder:"Type email and press comma or enter...",class:"w-full outline-none text-sm"},null,544),[[F,Z.value]])])]),$(i(V),{onClick:e[1]||(e[1]=t=>L.value=!0),variant:"outline",size:"sm",class:"mt-1"},{prefix:D(()=>[$(i(U),{name:"users",class:"w-4 h-4"})]),default:D(()=>[e[43]||(e[43]=G(" Select Group ",-1))]),_:1})]),s("p",zs," Total Recipients: "+C(ue.value)+" ("+C(he.value)+" valid, "+C(Ye.value)+" invalid, "+C(et.value)+" duplicates) ",1)]),s("div",null,[e[45]||(e[45]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[G("Subject "),s("span",{class:"text-red-500"},"*")],-1)),z(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.subject=t),type:"text",placeholder:"Enter email subject",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[F,l.value.subject]])]),s("div",null,[e[47]||(e[47]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Content Type",-1)),z(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.content_type=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...e[46]||(e[46]=[s("option",{value:"Rich Text"},"Rich Text",-1),s("option",{value:"Markdown"},"Markdown",-1),s("option",{value:"HTML"},"HTML",-1)])],512),[[Et,l.value.content_type]])]),s("div",null,[e[54]||(e[54]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[G("Message "),s("span",{class:"text-red-500"},"*")],-1)),l.value.content_type==="Rich Text"?(v(),g("div",Ds,[i(d)?(v(),g("div",Us,[s("div",Bs,[s("button",{type:"button",onClick:e[4]||(e[4]=t=>i(d).chain().focus().toggleBold().run()),class:M([{"bg-gray-200":i(d).isActive("bold")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Bold (Ctrl+B)"}," B ",2),s("button",{type:"button",onClick:e[5]||(e[5]=t=>i(d).chain().focus().toggleItalic().run()),class:M([{"bg-gray-200":i(d).isActive("italic")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 italic"]),title:"Italic (Ctrl+I)"}," I ",2),s("button",{type:"button",onClick:e[6]||(e[6]=t=>i(d).chain().focus().toggleUnderline().run()),class:M([{"bg-gray-200":i(d).isActive("underline")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 underline"]),title:"Underline (Ctrl+U)"}," U ",2),s("button",{type:"button",onClick:e[7]||(e[7]=t=>i(d).chain().focus().toggleStrike().run()),class:M([{"bg-gray-200":i(d).isActive("strike")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 line-through"]),title:"Strikethrough"}," S ",2),e[49]||(e[49]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("div",Fs,[s("button",{type:"button",onClick:e[8]||(e[8]=t=>y.value=!y.value),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 flex items-center gap-1",title:"Text Color"},[...e[48]||(e[48]=[G(" A ",-1),s("span",{class:"w-4 h-1 bg-current"},null,-1)])]),y.value?(v(),g("div",Ps,[z(s("input",{type:"color","onUpdate:modelValue":e[9]||(e[9]=t=>_.value=t),onChange:e[10]||(e[10]=t=>Ne(_.value)),class:"w-20 h-8"},null,544),[[F,_.value]]),s("button",{onClick:e[11]||(e[11]=t=>{i(d).chain().focus().unsetColor().run(),y.value=!1}),class:"mt-1 px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200 w-full"}," Clear ")])):A("",!0)]),s("div",Vs,[s("button",{type:"button",onClick:e[12]||(e[12]=t=>p.value=!p.value),class:M([{"bg-gray-200":i(d).isActive("highlight")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Highlight"}," 🎨 ",2),p.value?(v(),g("div",Ws,[z(s("input",{type:"color","onUpdate:modelValue":e[13]||(e[13]=t=>Y.value=t),onChange:e[14]||(e[14]=t=>je(Y.value)),class:"w-20 h-8"},null,544),[[F,Y.value]]),s("button",{onClick:e[15]||(e[15]=t=>{i(d).chain().focus().unsetHighlight().run(),p.value=!1}),class:"mt-1 px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200 w-full"}," Clear ")])):A("",!0)])]),s("div",Xs,[s("button",{type:"button",onClick:e[16]||(e[16]=t=>i(d).chain().focus().toggleHeading({level:1}).run()),class:M([{"bg-gray-200":i(d).isActive("heading",{level:1})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Heading 1"}," H1 ",2),s("button",{type:"button",onClick:e[17]||(e[17]=t=>i(d).chain().focus().toggleHeading({level:2}).run()),class:M([{"bg-gray-200":i(d).isActive("heading",{level:2})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Heading 2"}," H2 ",2),s("button",{type:"button",onClick:e[18]||(e[18]=t=>i(d).chain().focus().toggleHeading({level:3}).run()),class:M([{"bg-gray-200":i(d).isActive("heading",{level:3})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Heading 3"}," H3 ",2),s("button",{type:"button",onClick:e[19]||(e[19]=t=>i(d).chain().focus().setParagraph().run()),class:M([{"bg-gray-200":i(d).isActive("paragraph")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Paragraph"}," P ",2),e[50]||(e[50]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[20]||(e[20]=t=>i(d).chain().focus().setTextAlign("left").run()),class:M([{"bg-gray-200":i(d).isActive({textAlign:"left"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Align Left"}," ⫷ ",2),s("button",{type:"button",onClick:e[21]||(e[21]=t=>i(d).chain().focus().setTextAlign("center").run()),class:M([{"bg-gray-200":i(d).isActive({textAlign:"center"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Align Center"}," ≡ ",2),s("button",{type:"button",onClick:e[22]||(e[22]=t=>i(d).chain().focus().setTextAlign("right").run()),class:M([{"bg-gray-200":i(d).isActive({textAlign:"right"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Align Right"}," ⫸ ",2),s("button",{type:"button",onClick:e[23]||(e[23]=t=>i(d).chain().focus().setTextAlign("justify").run()),class:M([{"bg-gray-200":i(d).isActive({textAlign:"justify"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Justify"}," ▤ ",2)]),s("div",Ks,[s("button",{type:"button",onClick:e[24]||(e[24]=t=>i(d).chain().focus().toggleBulletList().run()),class:M([{"bg-gray-200":i(d).isActive("bulletList")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Bullet List"}," • ",2),s("button",{type:"button",onClick:e[25]||(e[25]=t=>i(d).chain().focus().toggleOrderedList().run()),class:M([{"bg-gray-200":i(d).isActive("orderedList")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Numbered List"}," 1. ",2),s("button",{type:"button",onClick:e[26]||(e[26]=t=>i(d).chain().focus().toggleBlockquote().run()),class:M([{"bg-gray-200":i(d).isActive("blockquote")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Quote"},' " ',2),s("button",{type:"button",onClick:e[27]||(e[27]=t=>i(d).chain().focus().toggleCodeBlock().run()),class:M([{"bg-gray-200":i(d).isActive("codeBlock")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-mono"]),title:"Code Block"}," </> ",2),e[51]||(e[51]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[28]||(e[28]=t=>n.$refs.imageInput.click()),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Upload Image"}," 📷 "),s("input",{ref_key:"imageInput",ref:fe,type:"file",accept:"image/*",onChange:pe,class:"hidden"},null,544),s("button",{type:"button",onClick:re,class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Insert Image URL"}," 🖼️ "),s("button",{type:"button",onClick:Ge,class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Insert Table"}," ⊞ "),e[52]||(e[52]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[29]||(e[29]=t=>i(d).chain().focus().setHorizontalRule().run()),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Horizontal Line"}," — "),e[53]||(e[53]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[30]||(e[30]=t=>i(d).chain().focus().undo().run()),disabled:!i(d).can().undo(),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Undo"}," ↶ ",8,qs),s("button",{type:"button",onClick:e[31]||(e[31]=t=>i(d).chain().focus().redo().run()),disabled:!i(d).can().redo(),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Redo"}," ↷ ",8,Zs)])])):A("",!0),$(i($t),{editor:i(d),class:"tiptap-editor"},null,8,["editor"])])):l.value.content_type==="Markdown"?(v(),g("div",Js,[z(s("textarea",{"onUpdate:modelValue":e[32]||(e[32]=t=>l.value.message_md=t),placeholder:"Compose your email message in Markdown...",rows:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"},null,512),[[F,l.value.message_md]])])):l.value.content_type==="HTML"?(v(),g("div",Qs,[z(s("textarea",{"onUpdate:modelValue":e[33]||(e[33]=t=>l.value.message_html=t),placeholder:"Compose your email message in HTML...",rows:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"},null,512),[[F,l.value.message_html]])])):A("",!0)]),s("div",null,[e[60]||(e[60]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Attachments",-1)),s("div",Ys,[N.value.length>0?(v(),g("div",en,[(v(!0),g(J,null,ne(N.value,(t,u)=>(v(),g("div",{key:"attachment-"+u,class:"inline-flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors"},[s("div",tn,[qe(t)?(v(),g("svg",sn,[...e[55]||(e[55]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):Ze(t)?(v(),g("svg",nn,[...e[56]||(e[56]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])):(v(),g("svg",on,[...e[57]||(e[57]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])]))]),s("div",rn,[s("div",ln,C(t.name),1),s("div",an,C(ke(t.size)),1)]),s("button",{type:"button",onClick:m=>Ke(u),class:"flex-shrink-0 text-gray-400 hover:text-red-600 transition-colors",title:"Remove attachment"},[$(i(U),{name:"x",class:"w-4 h-4"})],8,un)]))),128))])):A("",!0),s("div",dn,[s("input",{ref_key:"attachmentInput",ref:ye,type:"file",multiple:"",onChange:Xe,class:"hidden"},null,544),$(i(V),{onClick:e[34]||(e[34]=t=>n.$refs.attachmentInput.click()),variant:"outline",size:"sm"},{prefix:D(()=>[$(i(U),{name:"paperclip",class:"w-4 h-4"})]),default:D(()=>[e[58]||(e[58]=G(" Add Attachments ",-1))]),_:1}),N.value.length>0?(v(),g("span",cn,C(N.value.length)+" file"+C(N.value.length!==1?"s":"")+" ("+C(ke(Je.value))+") ",1)):A("",!0)]),e[59]||(e[59]=s("p",{class:"text-xs text-gray-500 mt-2"}," Maximum file size: 10MB per file. Supported formats: All common file types. ",-1))])]),s("div",mn,[e[64]||(e[64]=s("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Email Options",-1)),s("div",pn,[s("div",gn,[s("label",vn,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[35]||(e[35]=t=>l.value.send_unsubscribe_link=t),class:"mr-2"},null,512),[[Ae,l.value.send_unsubscribe_link]]),e[61]||(e[61]=s("span",{class:"text-sm text-gray-700"},"Send Unsubscribe Link",-1))])]),s("div",hn,[s("label",bn,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[36]||(e[36]=t=>x.value=t),class:"mr-2"},null,512),[[Ae,x.value]]),e[62]||(e[62]=s("span",{class:"text-sm text-gray-700"},"Schedule sending at a later time",-1))]),x.value?(v(),g("div",fn,[e[63]||(e[63]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Send Email At",-1)),z(s("input",{"onUpdate:modelValue":e[37]||(e[37]=t=>l.value.schedule_send=t),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[F,l.value.schedule_send]])])):A("",!0)])])]),s("div",yn,[s("div",null,[e[65]||(e[65]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Campaign (Optional)",-1)),z(s("input",{"onUpdate:modelValue":e[38]||(e[38]=t=>l.value.campaign=t),type:"text",placeholder:"Enter campaign name",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[F,l.value.campaign]])]),l.value.published?(v(),g("div",xn,[e[66]||(e[66]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Route",-1)),z(s("input",{"onUpdate:modelValue":e[39]||(e[39]=t=>l.value.route=t),type:"text",placeholder:"e.g., newsletter/my-newsletter",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[F,l.value.route]])])):A("",!0)])])]),s("div",wn,[$(i(V),{onClick:de,variant:"outline"},{default:D(()=>[...e[67]||(e[67]=[G(" Cancel ",-1)])]),_:1}),s("div",_n,[$(i(V),{onClick:nt,variant:"outline",loading:S.value},{prefix:D(()=>[$(i(U),{name:"save",class:"w-4 h-4"})]),default:D(()=>[e[68]||(e[68]=G(" Save Draft ",-1))]),_:1},8,["loading"]),$(i(V),{onClick:ot,variant:"solid",loading:w.value},{default:D(()=>[G(C(x.value?"Schedule Email":"Send Email"),1)]),_:1},8,["loading"])])])])])):A("",!0),$(gs,{show:L.value,"onUpdate:show":e[40]||(e[40]=t=>L.value=t),onGroupsSelected:st},null,8,["show"]),k.value?(v(),g("div",kn,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:ie}),s("div",Cn,[s("div",En,[e[69]||(e[69]=s("h2",{class:"text-lg font-semibold text-gray-900"},"Save Email Group",-1)),s("button",{onClick:ie,class:"text-gray-400 hover:text-gray-600"},[$(i(U),{name:"x",class:"w-5 h-5"})])]),s("div",$n,[s("p",Sn,C(P.value),1),s("div",Tn,[e[70]||(e[70]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Group Name (Optional) ",-1)),z(s("input",{ref_key:"groupNameInput",ref:Q,"onUpdate:modelValue":e[41]||(e[41]=t=>I.value=t),type:"text",placeholder:"e.g., Marketing Team",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeydown:St(Ee,["enter"])},null,544),[[F,I.value]]),e[71]||(e[71]=s("p",{class:"text-xs text-gray-500 mt-1"}," Leave empty to create a temporary group ",-1))]),s("div",Mn,[e[72]||(e[72]=s("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Recipients to be saved:",-1)),s("div",An,[(v(!0),g(J,null,ne(T.value,t=>(v(),g("div",{key:t,class:"py-1"},C(t),1))),128))]),s("div",Ln," Total: "+C(T.value.length)+" recipients ",1)])]),s("div",In,[$(i(V),{onClick:ie,variant:"outline"},{default:D(()=>[...e[73]||(e[73]=[G(" Cancel ",-1)])]),_:1}),$(i(V),{onClick:Qe,variant:"outline"},{default:D(()=>[...e[74]||(e[74]=[G(" Skip (Create Temporary) ",-1)])]),_:1}),$(i(V),{onClick:Ee,variant:"solid"},{default:D(()=>[G(C(I.value?"Save Group":"Continue"),1)]),_:1})])])])):A("",!0)],64))}};export{jn as _,W as c};
//# sourceMappingURL=ComposeEmailDialog-Bj9SiQLI.js.map
