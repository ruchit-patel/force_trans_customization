var L=(B,b,v)=>new Promise((m,x)=>{var f=i=>{try{g(v.next(i))}catch(y){x(y)}},d=i=>{try{g(v.throw(i))}catch(y){x(y)}},g=i=>i.done?m(i.value):Promise.resolve(i.value).then(f,d);g((v=v.apply(B,b)).next())});import{r as h,c as $,o as oe,A as u,G as t,M as n,L as c,P as o,E as l,a8 as T,a9 as ne,ab as z,aa as ie,K as U,I as S,F as I,T as Y,D as p,ag as re,z as r,V as w,S as D,am as R,an as de,B as W}from"./index-CsQVcF8n.js";import{_ as ue,c as A}from"./ComposeEmailDialog-Dajqmh4R.js";const ce={class:"min-h-screen bg-gray-50"},me={class:"bg-white shadow-sm border-b"},xe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},pe={class:"flex justify-between items-center py-4"},ve={class:"flex items-center space-x-4"},ge={class:"flex space-x-4"},fe={class:"flex items-center space-x-4"},ye={class:"text-sm text-gray-600"},_e={class:"bg-white border-b border-gray-200"},he={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},be={class:"flex items-center justify-between"},we={class:"bg-white border-b border-gray-200"},ke={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Se={class:"flex items-center gap-4"},Ce={class:"flex-1 max-w-md"},De={class:"relative"},$e={class:"w-48"},Te={class:"w-48"},Ve={key:0,class:"mt-3 flex items-center gap-2 text-sm text-gray-600"},Ne={key:0,class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded"},Fe={key:1,class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded"},Me={key:2,class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded"},je={class:"text-gray-500"},Ee={key:0,class:"flex items-center justify-center flex-1"},Le={class:"text-center"},ze={key:1,class:"flex items-center justify-center flex-1"},Ae={class:"text-center max-w-md"},Be={class:"text-gray-500 mb-6"},Pe={key:2,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Ue={class:"bg-white rounded-lg shadow overflow-hidden"},Ie={class:"min-w-full divide-y divide-gray-200"},Ye={class:"bg-white divide-y divide-gray-200"},Re={class:"px-6 py-4"},We={class:"flex items-center"},Ge={class:"text-sm font-medium text-gray-900"},Ke={class:"text-xs text-gray-500"},Oe={class:"px-6 py-4 whitespace-nowrap"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},qe={class:"px-6 py-4 whitespace-nowrap"},He={class:"text-sm text-gray-900"},Je={class:"text-xs text-gray-500"},Xe={class:"px-6 py-4 whitespace-nowrap"},Ze={class:"text-sm text-gray-900"},et={class:"text-xs text-gray-500"},tt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},st=["onClick"],at=["onClick"],lt={class:"mt-4 flex items-center justify-between bg-white px-6 py-3 rounded-lg shadow"},ot={class:"flex items-center gap-4"},nt={class:"text-sm text-gray-700"},it={class:"font-medium"},rt={class:"font-medium"},dt={class:"font-medium"},ut={class:"flex items-center gap-2"},ct={class:"flex items-center gap-1"},mt=["onClick"],gt={__name:"SentEmails",setup(B){const b=h([]),v=h(!1),m=h(""),x=h("all"),f=h("all"),d=h(1),g=h(20),i=h(0),y=h(!1);let V=null;const N=$(()=>x.value!=="all"||f.value!=="all"||m.value!==""),F=$(()=>Math.ceil(i.value/g.value)),M=$(()=>(d.value-1)*g.value),G=$(()=>Math.min(M.value+g.value,i.value)),K=$(()=>{const s=[];let _=Math.max(1,d.value-Math.floor(2.5)),a=Math.min(F.value,_+5-1);a-_+1<5&&(_=Math.max(1,a-5+1));for(let C=_;C<=a;C++)s.push(C);return s}),O=()=>{const s=new Date;let e=null;switch(f.value){case"today":e=new Date(s.getFullYear(),s.getMonth(),s.getDate());break;case"week":e=new Date(s.getFullYear(),s.getMonth(),s.getDate()-7);break;case"month":e=new Date(s.getFullYear(),s.getMonth(),1);break;case"year":e=new Date(s.getFullYear(),0,1);break}return e?e.toISOString().split("T")[0]+" 00:00:00":null},Q=()=>{const s=[];x.value==="sent"?s.push(["email_sent","=",1]):x.value==="scheduled"?(s.push(["schedule_sending","=",1]),s.push(["email_sent","=",0])):x.value==="draft"&&(s.push(["email_sent","=",0]),s.push(["schedule_sending","=",0]));const e=O();return e&&s.push(["modified",">=",e]),m.value&&s.push([["subject","like",`%${m.value}%`],"or",["sender_name","like",`%${m.value}%`],"or",["sender_email","like",`%${m.value}%`]]),s},k=()=>L(this,null,function*(){v.value=!0;try{console.log("Loading newsletters with filters...");const s=Q(),e=yield A("frappe.client.get_list",{doctype:"Newsletter",fields:["name","subject","sender_name","sender_email","email_sent","email_sent_at","schedule_sending","schedule_send","total_recipients","total_views","modified","owner"],filters:s,order_by:"modified desc",limit_start:M.value,limit_page_length:g.value}),_=yield A("frappe.client.get_count",{doctype:"Newsletter",filters:s});b.value=e||[],i.value=_||0,console.log(`Loaded ${b.value.length} newsletters (${i.value} total)`)}catch(s){console.error("Error loading newsletters:",s),b.value=[],i.value=0}finally{v.value=!1}}),P=()=>{d.value=1,k()},j=()=>{d.value=1,k()},q=()=>{V&&clearTimeout(V),V=setTimeout(()=>{j()},500)},H=()=>{m.value="",x.value="all",f.value="all",d.value=1,k()},E=s=>{s>=1&&s<=F.value&&(d.value=s,k())},J=()=>{d.value=1,k()},X=s=>s.email_sent?"Sent":s.schedule_sending?"Scheduled":"Draft",Z=s=>s.email_sent?"bg-green-100 text-green-800":s.schedule_sending?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800",ee=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",te=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",se=s=>{window.open(`/app/newsletter/${s.name}`,"_blank")},ae=s=>L(this,null,function*(){if(confirm(`Are you sure you want to delete "${s.subject}"?`))try{yield A("frappe.client.delete",{doctype:"Newsletter",name:s.name}),k(),console.log(`Deleted newsletter: ${s.name}`)}catch(e){console.error("Error deleting newsletter:",e),alert(`Failed to delete newsletter: ${e.message||e}`)}}),le=s=>{y.value=!1,P()};return oe(()=>{k()}),(s,e)=>{const _=re("router-link");return r(),u("div",ce,[t("div",me,[t("div",xe,[t("div",pe,[t("div",ve,[e[13]||(e[13]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Ticket Tracker",-1)),t("nav",ge,[n(_,{to:"/",class:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium","active-class":"bg-blue-100 text-blue-700","inactive-class":"text-gray-600 hover:text-gray-900"},{default:c(()=>e[9]||(e[9]=[p(" Tickets ")])),_:1,__:[9]}),n(_,{to:"/sent-emails",class:"bg-blue-100 text-blue-700 px-3 py-2 rounded-md text-sm font-medium","active-class":"bg-blue-100 text-blue-700","inactive-class":"text-gray-600 hover:text-gray-900"},{default:c(()=>e[10]||(e[10]=[p(" Sent Emails ")])),_:1,__:[10]}),e[11]||(e[11]=t("a",{href:"/app/support",class:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium"}," Desk ",-1)),e[12]||(e[12]=t("a",{href:"/intro",class:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium"}," Wiki ",-1))])]),t("div",fe,[n(o(D),{onClick:e[0]||(e[0]=a=>y.value=!0),variant:"solid",size:"sm"},{prefix:c(()=>[n(o(w),{name:"mail",class:"w-4 h-4"})]),default:c(()=>[e[14]||(e[14]=p(" Compose Email "))]),_:1,__:[14]}),t("span",ye,l(o(R).user),1),n(o(D),{onClick:e[1]||(e[1]=a=>o(R).logout.submit()),variant:"outline",size:"sm"},{default:c(()=>e[15]||(e[15]=[p(" Logout ")])),_:1,__:[15]})])])])]),t("div",_e,[t("div",he,[t("div",be,[e[17]||(e[17]=t("div",null,[t("h2",{class:"text-2xl font-semibold text-gray-900"},"Sent Emails"),t("p",{class:"text-sm text-gray-500 mt-1"},"View all newsletters sent, scheduled, or saved as drafts")],-1)),n(o(D),{onClick:P,loading:v.value},{prefix:c(()=>[n(o(w),{name:"refresh-cw",class:"w-4 h-4"})]),default:c(()=>[e[16]||(e[16]=p(" Refresh "))]),_:1,__:[16]},8,["loading"])])])]),t("div",we,[t("div",ke,[t("div",Se,[t("div",Ce,[t("div",De,[n(o(w),{name:"search",class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),T(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),type:"text",placeholder:"Search by subject or sender...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:q},null,544),[[ne,m.value]])])]),t("div",$e,[T(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),onChange:j,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[18]||(e[18]=[t("option",{value:"all"},"All Status",-1),t("option",{value:"sent"},"Sent",-1),t("option",{value:"scheduled"},"Scheduled",-1),t("option",{value:"draft"},"Draft",-1)]),544),[[z,x.value]])]),t("div",Te,[T(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),onChange:j,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[19]||(e[19]=[ie('<option value="all">All Time</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option><option value="year">This Year</option>',5)]),544),[[z,f.value]])]),N.value?(r(),U(o(D),{key:0,onClick:H,variant:"ghost"},{prefix:c(()=>[n(o(w),{name:"x",class:"w-4 h-4"})]),default:c(()=>[e[20]||(e[20]=p(" Clear "))]),_:1,__:[20]})):S("",!0)]),N.value?(r(),u("div",Ve,[e[21]||(e[21]=t("span",{class:"font-medium"},"Active filters:",-1)),x.value!=="all"?(r(),u("span",Ne," Status: "+l(x.value),1)):S("",!0),f.value!=="all"?(r(),u("span",Fe," Date: "+l(f.value),1)):S("",!0),m.value?(r(),u("span",Me,' Search: "'+l(m.value)+'" ',1)):S("",!0),t("span",je,l(i.value)+" results",1)])):S("",!0)])]),v.value&&b.value.length===0?(r(),u("div",Ee,[t("div",Le,[n(o(de),{class:"w-8 h-8 mx-auto mb-4"}),e[22]||(e[22]=t("p",{class:"text-gray-500"},"Loading newsletters...",-1))])])):!v.value&&b.value.length===0?(r(),u("div",ze,[t("div",Ae,[n(o(w),{name:"mail",class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No newsletters found",-1)),t("p",Be,l(N.value?"No newsletters match your filters. Try adjusting your search.":"You haven't sent any newsletters yet. Create one from the Issues page."),1)])])):(r(),u("div",Pe,[t("div",null,[t("div",Ue,[t("table",Ie,[e[24]||(e[24]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Subject "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Recipients "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Sent By "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",Ye,[(r(!0),u(I,null,Y(b.value,a=>(r(),u("tr",{key:a.name,class:"hover:bg-gray-50"},[t("td",Re,[t("div",We,[n(o(w),{name:"mail",class:"w-4 h-4 text-gray-400 mr-3"}),t("div",null,[t("div",Ge,l(a.subject),1),t("div",Ke,l(a.name),1)])])]),t("td",Oe,[t("span",{class:W([Z(a),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(X(a)),3)]),t("td",Qe,l(a.total_recipients||0),1),t("td",qe,[t("div",He,l(a.sender_name||"Unknown"),1),t("div",Je,l(a.sender_email),1)]),t("td",Xe,[t("div",Ze,l(ee(a.email_sent_at||a.schedule_send||a.modified)),1),t("div",et,l(te(a.email_sent_at||a.schedule_send||a.modified)),1)]),t("td",tt,[t("button",{onClick:C=>se(a),class:"text-blue-600 hover:text-blue-900 mr-4"}," View ",8,st),a.email_sent?S("",!0):(r(),u("button",{key:0,onClick:C=>ae(a),class:"text-red-600 hover:text-red-900"}," Delete ",8,at))])]))),128))])])]),t("div",lt,[t("div",ot,[t("span",nt,[e[25]||(e[25]=p(" Showing ")),t("span",it,l(M.value+1),1),e[26]||(e[26]=p(" to ")),t("span",rt,l(G.value),1),e[27]||(e[27]=p(" of ")),t("span",dt,l(i.value),1),e[28]||(e[28]=p(" results "))]),T(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),onChange:J,class:"border border-gray-300 rounded px-2 py-1 text-sm"},e[29]||(e[29]=[t("option",{value:10},"10 per page",-1),t("option",{value:20},"20 per page",-1),t("option",{value:50},"50 per page",-1),t("option",{value:100},"100 per page",-1)]),544),[[z,g.value]])]),t("div",ut,[n(o(D),{onClick:e[6]||(e[6]=a=>E(d.value-1)),disabled:d.value===1,variant:"ghost",size:"sm"},{prefix:c(()=>[n(o(w),{name:"chevron-left",class:"w-4 h-4"})]),default:c(()=>[e[30]||(e[30]=p(" Previous "))]),_:1,__:[30]},8,["disabled"]),t("div",ct,[(r(!0),u(I,null,Y(K.value,a=>(r(),u("button",{key:a,onClick:C=>E(a),class:W(["px-3 py-1 text-sm rounded",a===d.value?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"])},l(a),11,mt))),128))]),n(o(D),{onClick:e[7]||(e[7]=a=>E(d.value+1)),disabled:d.value===F.value,variant:"ghost",size:"sm"},{suffix:c(()=>[n(o(w),{name:"chevron-right",class:"w-4 h-4"})]),default:c(()=>[e[31]||(e[31]=p(" Next "))]),_:1,__:[31]},8,["disabled"])])])])])),y.value?(r(),U(ue,{key:3,show:y.value,onClose:e[8]||(e[8]=a=>y.value=!1),onEmailSent:le},null,8,["show"])):S("",!0)])}}};export{gt as default};
//# sourceMappingURL=SentEmails-Bb9pVgLq.js.map
