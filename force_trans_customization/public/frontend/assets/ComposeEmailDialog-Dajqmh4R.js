var Qe=Object.defineProperty,Ye=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var et=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var Ce=(n,c,h)=>c in n?Qe(n,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):n[c]=h,$e=(n,c)=>{for(var h in c||(c={}))et.call(c,h)&&Ce(n,h,c[h]);if(ke)for(var h of ke(c))tt.call(c,h)&&Ce(n,h,c[h]);return n},Ee=(n,c)=>Ye(n,Ze(c));var z=(n,c,h)=>new Promise((L,q)=>{var S=m=>{try{f(h.next(m))}catch(y){q(y)}},T=m=>{try{f(h.throw(m))}catch(y){q(y)}},f=m=>m.done?L(m.value):Promise.resolve(m.value).then(S,T);f((h=h.apply(n,c)).next())});import{ao as Me,ap as fe,aq as st,ar as lt,as as Se,at as ot,au as nt,c as Y,r as _,o as rt,a6 as oe,z as v,A as b,G as s,M as k,P as a,V as D,a8 as N,a9 as P,D as H,F as Z,T as le,Z as Te,E as w,I as M,L as B,S as K,av as at,aw as it,ax as ut,ay as dt,az as ct,aA as mt,aB as pt,aC as gt,aD as vt,B as E,ab as bt,aE as ft,aF as Ae,ac as yt,am as me}from"./index-CsQVcF8n.js";function X(L,q){return z(this,arguments,function*(n,c,h={}){c||(c={});let S=Object.assign({Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-Frappe-Site-Name":window.location.hostname},h.headers||{});window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&(S["X-Frappe-CSRF-Token"]=window.csrf_token);let T=n.startsWith("/")?n:`/api/method/${n}`;const f=yield fetch(T,{method:"POST",headers:S,body:JSON.stringify(c)});if(f.ok){const m=yield f.json();if(m.docs||n==="login")return m;if(m.exc)try{console.groupCollapsed(n),console.log(`method: ${n}`),console.log("params:",c);let y=JSON.parse(m.exc);for(let C of y)console.log(C);console.groupEnd()}catch(y){console.warn("Error printing debug messages",y)}return m.message}else{let m=yield f.text(),y,C;try{y=JSON.parse(m)}catch(F){}let J=[[n,y.exc_type,y._error_message].filter(Boolean).join(" ")];if(y.exc){C=y.exc;try{C=JSON.parse(C)[0],console.log(C)}catch(F){}}let x=new Error(J.join(`
`));throw x.exc_type=y.exc_type,x.exc=C,x.status=f.status,x.messages=y._server_messages?JSON.parse(y._server_messages):[],x.messages=x.messages.concat(y.message),x.messages=x.messages.map(F=>{try{return JSON.parse(F).message}catch(U){return F}}),x.messages=x.messages.filter(Boolean),x.messages.length||(x.messages=y._error_message?[y._error_message]:["Internal Server Error"]),h.onError&&h.onError({response:f,status:f.status,error:x}),x}})}const ht=Me.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),xt=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,wt=st.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:n}){return["img",fe(this.options.HTMLAttributes,n)]},addCommands(){return{setImage:n=>({commands:c})=>c.insertContent({type:this.name,attrs:n})}},addInputRules(){return[lt({find:xt,type:this.type,getAttributes:n=>{const[,,c,h,L]=n;return{src:h,alt:c,title:L}}})]}}),_t=wt.extend({addAttributes(){return{src:{default:null},alt:{default:null},style:{default:"width: 100%; height: auto; cursor: pointer;",parseHTML:n=>{const c=n.getAttribute("width");return c?`width: ${c}px; height: auto; cursor: pointer;`:`${n.style.cssText}`}},title:{default:null},loading:{default:null},srcset:{default:null},sizes:{default:null},crossorigin:{default:null},usemap:{default:null},ismap:{default:null},width:{default:null},height:{default:null},referrerpolicy:{default:null},longdesc:{default:null},decoding:{default:null},class:{default:null},id:{default:null},name:{default:null},draggable:{default:!0},tabindex:{default:null},"aria-label":{default:null},"aria-labelledby":{default:null},"aria-describedby":{default:null}}},addNodeView(){return({node:n,editor:c,getPos:h})=>{const{view:L,options:{editable:q}}=c,{style:S}=n.attrs,T=document.createElement("div"),f=document.createElement("div"),m=document.createElement("img"),y="width: 24px; height: 24px; cursor: pointer;",C=()=>{if(typeof h=="function"){const A=Object.assign(Object.assign({},n.attrs),{style:`${m.style.cssText}`});L.dispatch(L.state.tr.setNodeMarkup(h(),null,A))}},J=()=>{const A=document.createElement("div"),d=document.createElement("img"),u=document.createElement("img"),g=document.createElement("img");A.setAttribute("style","position: absolute; top: 0%; left: 50%; width: 100px; height: 25px; z-index: 999; background-color: rgba(255, 255, 255, 0.7); border-radius: 4px; border: 2px solid #6C6C6C; cursor: pointer; transform: translate(-50%, -50%); display: flex; justify-content: space-between; align-items: center; padding: 0 10px;"),d.setAttribute("src","https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_left/default/20px.svg"),d.setAttribute("style",y),u.setAttribute("src","https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_center/default/20px.svg"),u.setAttribute("style",y),g.setAttribute("src","https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/format_align_right/default/20px.svg"),g.setAttribute("style",y),d.addEventListener("click",()=>{T.setAttribute("style","display: flex; justify-content: flex-start;"),m.setAttribute("style",`${m.style.cssText} justify-content: flex-start;`),C()}),u.addEventListener("click",()=>{T.setAttribute("style","display: flex; justify-content: center;"),m.setAttribute("style",`${m.style.cssText} justify-content: center;`),C()}),g.addEventListener("click",()=>{T.setAttribute("style","display: flex; justify-content: flex-end;"),m.setAttribute("style",`${m.style.cssText} justify-content: flex-end;`),C()}),A.appendChild(d),A.appendChild(u),A.appendChild(g),f.appendChild(A)};T.appendChild(f);const x=S.match(/justify-content: (.*?);/);if(T.setAttribute("style",`display: flex; ${x?x[0]:""}`),x&&(m.className=`tiptap-image-${x[1]}`),f.setAttribute("style",`${S}`),f.appendChild(m),Object.entries(n.attrs).forEach(([A,d])=>{d!=null&&m.setAttribute(A,d)}),!q)return{dom:m};const F=["top: -4px; left: -4px; cursor: nwse-resize;","top: -4px; right: -4px; cursor: nesw-resize;","bottom: -4px; left: -4px; cursor: nesw-resize;","bottom: -4px; right: -4px; cursor: nwse-resize;"];let U=!1,i,ee,Q;return f.addEventListener("click",()=>{if(f.childElementCount>3)for(let A=0;A<5;A++)f.removeChild(f.lastChild);J(),f.setAttribute("style",`position: relative; border: 1px dashed #6C6C6C; ${S} cursor: pointer;`),Array.from({length:4},(A,d)=>{const u=document.createElement("div");u.setAttribute("style",`position: absolute; width: 9px; height: 9px; border: 1.5px solid #6C6C6C; border-radius: 50%; ${F[d]}`),u.addEventListener("mousedown",g=>{g.preventDefault(),U=!0,i=g.clientX,ee=f.offsetWidth,Q=f.offsetHeight;const V=ie=>{if(!U)return;const pe=d%2===0?-(ie.clientX-i):ie.clientX-i,ge=ee/Q,O=ee+pe,I=O/ge;f.style.width=O+"px",f.style.height=I+"px",m.style.width=O+"px",m.style.height=I+"px"},te=()=>{U&&(U=!1),C(),document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",te)};document.addEventListener("mousemove",V),document.addEventListener("mouseup",te)}),f.appendChild(u)})}),document.addEventListener("click",A=>{const d=A.target;if(!(f.contains(d)||d.style.cssText===y)){const g=f.getAttribute("style"),V=g==null?void 0:g.replace("border: 1px dashed #6C6C6C;","");if(f.setAttribute("style",V),f.childElementCount>3)for(let te=0;te<5;te++)f.removeChild(f.lastChild)}}),{dom:T}}}}),kt=Se.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:n=>{var c;return(c=n.style.color)===null||c===void 0?void 0:c.replace(/['"]+/g,"")},renderHTML:n=>n.color?{style:`color: ${n.color}`}:{}}}}]},addCommands(){return{setColor:n=>({chain:c})=>c().setMark("textStyle",{color:n}).run(),unsetColor:()=>({chain:n})=>n().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Ct=Se.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:n=>{var c;return(c=n.style.fontFamily)===null||c===void 0?void 0:c.replace(/['"]+/g,"")},renderHTML:n=>n.fontFamily?{style:`font-family: ${n.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:n=>({chain:c})=>c().setMark("textStyle",{fontFamily:n}).run(),unsetFontFamily:()=>({chain:n})=>n().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),$t=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Et=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,At=Me.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:n=>n.getAttribute("data-color")||n.style.backgroundColor,renderHTML:n=>n.color?{"data-color":n.color,style:`background-color: ${n.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:n}){return["mark",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{setHighlight:n=>({commands:c})=>c.setMark(this.name,n),toggleHighlight:n=>({commands:c})=>c.toggleMark(this.name,n),unsetHighlight:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[ot({find:$t,type:this.type})]},addPasteRules(){return[nt({find:Et,type:this.type})]}}),Mt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},St={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden"},Tt={class:"flex items-center justify-between p-6 border-b border-gray-200"},Lt={class:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]"},jt={class:"space-y-4"},Gt={class:"relative"},Ht={class:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg"},It={key:0,class:"p-8 text-center"},Ut={key:1,class:"p-8 text-center text-gray-500"},Rt={key:2,class:"divide-y divide-gray-200"},zt=["onClick"],Nt={class:"flex items-center justify-between"},Bt={class:"flex items-center space-x-3"},Dt=["checked","onChange"],Ft={class:"font-medium text-gray-900"},Vt={class:"text-sm text-gray-500"},Ot={key:0,class:"text-xs text-gray-400 mt-1"},Pt={class:"text-right"},qt={class:"text-sm text-gray-500"},Wt={key:0,class:"text-xs text-gray-400"},Kt={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Xt={class:"font-medium text-blue-900 mb-2"},Jt={class:"space-y-1"},Qt={class:"text-blue-800"},Yt={class:"text-blue-600"},Zt={class:"mt-2 pt-2 border-t border-blue-200"},es={class:"font-medium text-blue-900"},ts={class:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50"},ss={__name:"GroupSelectorDialog",props:{show:{type:Boolean,default:!1}},emits:["update:show","groups-selected"],setup(n,{emit:c}){const h=n,L=c,q=Y({get:()=>h.show,set:d=>L("update:show",d)}),S=_(""),T=_(!1),f=_([]),m=_([]),y=_({}),C=Y(()=>{if(!S.value)return f.value;const d=S.value.toLowerCase();return f.value.filter(u=>u.name.toLowerCase().includes(d)||u.description&&u.description.toLowerCase().includes(d))}),J=Y(()=>m.value.reduce((d,u)=>d+(u.email_count||0),0)),x=()=>z(this,null,function*(){T.value=!0;try{console.log("Loading email groups from Frappe...");const d=yield X("frappe.client.get_list",{doctype:"Email Group",fields:["name","title","total_subscribers","creation","modified"],filters:[["title","not like","temp-grp-%"]],order_by:"modified desc",limit_page_length:100});console.log("Email Groups loaded:",d),f.value=d.map(u=>({name:u.name,title:u.title||u.name,email_count:u.total_subscribers||0,description:"",creation:u.creation,modified:u.modified,emails:[]}))}catch(d){console.error("Error loading email groups:",d),f.value=[]}finally{T.value=!1}}),F=d=>z(this,null,function*(){if(y.value[d])return y.value[d];try{console.log("Loading members for group:",d);const g=(yield X("frappe.client.get_list",{doctype:"Email Group Member",fields:["email","email_group"],filters:[["email_group","=",d]],limit_page_length:1e3})).map(V=>V.email);return y.value[d]=g,g}catch(u){return console.error("Error loading group members:",u),[]}}),U=d=>m.value.some(u=>u.name===d.name),i=d=>z(this,null,function*(){const u=m.value.findIndex(g=>g.name===d.name);if(u>-1)m.value.splice(u,1);else{const g=yield F(d.name);m.value.push(Ee($e({},d),{emails:g}))}}),ee=()=>{L("groups-selected",[...m.value]),Q()},Q=()=>{q.value=!1,m.value=[],S.value=""},A=d=>{if(!d)return"N/A";try{return new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(u){return"Invalid Date"}};return rt(()=>{h.show&&x()}),oe(()=>h.show,d=>{d&&x()}),(d,u)=>q.value?(v(),b("div",Mt,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:Q}),s("div",St,[s("div",Tt,[u[2]||(u[2]=s("h2",{class:"text-lg font-semibold text-gray-900"},"Select Email Groups",-1)),s("button",{onClick:Q,class:"text-gray-400 hover:text-gray-600"},[k(a(D),{name:"x",class:"w-5 h-5"})])]),s("div",Lt,[s("div",jt,[s("div",Gt,[k(a(D),{name:"search",class:"w-4 h-4 text-gray-400 absolute left-3 top-3"}),N(s("input",{"onUpdate:modelValue":u[0]||(u[0]=g=>S.value=g),type:"text",placeholder:"Search email groups...",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,S.value]])]),s("div",Ht,[T.value?(v(),b("div",It,u[3]||(u[3]=[s("div",{class:"flex items-center justify-center"},[s("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500 mr-2"}),H(" Loading email groups... ")],-1)]))):C.value.length===0?(v(),b("div",Ut,[k(a(D),{name:"inbox",class:"w-8 h-8 mx-auto mb-2 text-gray-300"}),u[4]||(u[4]=s("p",null,"No email groups found",-1)),u[5]||(u[5]=s("p",{class:"text-xs mt-1"},"Create email groups in the system to see them here",-1))])):(v(),b("div",Rt,[(v(!0),b(Z,null,le(C.value,g=>(v(),b("div",{key:g.name,class:"p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:V=>i(g)},[s("div",Nt,[s("div",Bt,[s("input",{type:"checkbox",checked:U(g),onChange:V=>i(g),onClick:u[1]||(u[1]=Te(()=>{},["stop"])),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"},null,40,Dt),s("div",null,[s("div",Ft,w(g.title||g.name),1),s("div",Vt,w(g.email_count||0)+" recipients ",1),g.description?(v(),b("div",Ot,w(g.description),1)):M("",!0)])]),s("div",Pt,[s("div",qt," Created: "+w(A(g.creation)),1),g.modified!==g.creation?(v(),b("div",Wt," Modified: "+w(A(g.modified)),1)):M("",!0)])])],8,zt))),128))]))]),m.value.length>0?(v(),b("div",Kt,[s("h4",Xt,"Selected Groups ("+w(m.value.length)+")",1),s("div",Jt,[(v(!0),b(Z,null,le(m.value,g=>(v(),b("div",{key:g.name,class:"flex items-center justify-between text-sm"},[s("span",Qt,w(g.title||g.name),1),s("span",Yt,w(g.email_count||0)+" recipients",1)]))),128))]),s("div",Zt,[s("span",es," Total Recipients: "+w(J.value),1)])])):M("",!0)])]),s("div",ts,[k(a(K),{onClick:Q,variant:"outline"},{default:B(()=>u[6]||(u[6]=[H(" Cancel ")])),_:1,__:[6]}),k(a(K),{onClick:ee,variant:"solid"},{default:B(()=>u[7]||(u[7]=[H(" Done ")])),_:1,__:[7]})])])])):M("",!0)}},ls={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},os={class:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden"},ns={class:"flex items-center justify-between p-6 border-b border-gray-200"},rs={class:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]"},as={class:"space-y-6"},is={class:"flex items-start space-x-2"},us={class:"flex-1"},ds={class:"w-full min-h-[80px] px-3 py-2 border border-gray-300 rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500"},cs={class:"flex flex-wrap gap-2 mb-2"},ms=["onClick"],ps={class:"font-medium"},gs={class:"text-xs text-blue-600"},vs=["onClick"],bs={key:0,class:"absolute z-20 mt-1 p-3 bg-white border border-gray-300 rounded-lg shadow-lg max-w-xs"},fs={class:"flex items-center justify-between mb-2"},ys={class:"text-sm font-semibold text-gray-700"},hs=["onClick"],xs={class:"max-h-40 overflow-y-auto space-y-1"},ws={key:0,class:"text-xs text-gray-400 italic"},_s=["title"],ks={key:0,class:"text-red-600"},Cs={key:1,class:"text-yellow-600"},$s={key:2,class:"text-green-600"},Es=["onClick"],As={class:"text-xs text-gray-500 mt-1"},Ms={key:0,class:"border border-gray-300 rounded-lg overflow-hidden"},Ss={key:0,class:"bg-gray-50 p-2 border-b border-gray-300"},Ts={class:"flex flex-wrap gap-1 mb-2"},Ls={class:"relative inline-block"},js={key:0,class:"absolute z-10 mt-1 p-2 bg-white border border-gray-300 rounded shadow-lg"},Gs={class:"relative inline-block"},Hs={key:0,class:"absolute z-10 mt-1 p-2 bg-white border border-gray-300 rounded shadow-lg"},Is={class:"flex flex-wrap gap-1 mb-2"},Us={class:"flex flex-wrap gap-1"},Rs=["disabled"],zs=["disabled"],Ns={key:1},Bs={key:2},Ds={class:"border border-gray-300 rounded-lg p-4 bg-gray-50"},Fs={key:0,class:"flex flex-wrap gap-2 mb-3"},Vs={class:"flex-shrink-0"},Os={key:0,class:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ps={key:1,class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qs={key:2,class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ws={class:"flex-1 min-w-0"},Ks={class:"font-medium text-gray-900 truncate"},Xs={class:"text-xs text-gray-500"},Js=["onClick"],Qs={class:"flex items-center gap-2"},Ys={key:0,class:"text-xs text-gray-500"},Zs={class:"bg-gray-50 p-4 rounded-lg"},el={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tl={class:"space-y-3"},sl={class:"flex items-center"},ll={class:"space-y-3"},ol={class:"flex items-center"},nl={key:0},rl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},al={key:0},il={class:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50"},ul={class:"flex items-center space-x-3"},dl={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},cl={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},ml={class:"flex items-center justify-between p-6 border-b border-gray-200"},pl={class:"p-6"},gl={class:"text-sm text-gray-600 mb-4"},vl={class:"mb-4"},bl={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},fl={class:"text-xs text-blue-800 space-y-1 max-h-32 overflow-y-auto"},yl={class:"mt-2 pt-2 border-t border-blue-200 text-sm font-medium text-blue-900"},hl={class:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50"},xl=10*1024*1024,kl={__name:"ComposeEmailDialog",props:{show:{type:Boolean,default:!1}},emits:["update:show","email-sent"],setup(n,{emit:c}){const h=n,L=c,q=Y({get:()=>h.show,set:l=>L("update:show",l)}),S=_(!1),T=_(!1),f=_(!1),m=_(!1),y=_(!1),C=_(""),J=_(null),x=_([]),F=_(""),U=_(null),i=at({extensions:[it,ht,_t.configure({inline:!0,allowBase64:!0}),ut.configure({types:["heading","paragraph"]}),dt,kt,Ct,At.configure({multicolor:!0}),ct.configure({resizable:!0}),mt,pt,gt],content:"",editorProps:{attributes:{class:"w-full px-3 py-2 focus:outline-none min-h-[200px] max-h-[400px] overflow-y-auto prose prose-sm max-w-none"}},onUpdate:({editor:l})=>{o.value.message=l.getHTML()}}),ee=_(null),Q=()=>{const l=prompt("Enter image URL (or paste base64 data URI):");l&&i.value.chain().focus().setImage({src:l}).run()},A=l=>{const e=l.target.files[0];if(e&&e.type.startsWith("image/")){const t=new FileReader;t.onload=r=>{i.value.chain().focus().setImage({src:r.target.result}).run()},t.readAsDataURL(e)}},d=_(!1),u=_(!1),g=_("#000000"),V=_("#ffff00"),te=l=>{i.value.chain().focus().setColor(l).run(),d.value=!1},ie=l=>{i.value.chain().focus().toggleHighlight({color:l}).run(),u.value=!1},pe=()=>{i.value.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},ge=_(null),O=_(""),I=_([]),G=_([]),se=_([]),ve=_(null),W=_([]),Le=l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.trim()),je=l=>{const e=l.trim();if(!e)return"Email cannot be empty";if(!e.includes("@"))return"Email must contain @ symbol";const t=e.split("@");return t.length!==2?"Email must have exactly one @ symbol":t[0]?t[1]?t[1].includes(".")?t[1].split(".").some(p=>!p)?"Domain parts cannot be empty":/\s/.test(e)?"Email cannot contain spaces":"Invalid email format":"Domain must contain a dot (.)":"Email must have a domain after @":"Email must have a username before @"},Ge=l=>{const e=l.toLowerCase().trim();if(I.value.findIndex(r=>r.address.toLowerCase()===e)>-1)return"Already added manually";for(const r of G.value)if(r.emails&&r.emails.some(p=>p.toLowerCase()===e))return`Already in group: ${r.name}`;return null},be=l=>{const e=l.trim();if(!e)return;let t="valid",r="";if(!Le(e))t="invalid",r=je(e);else{const p=Ge(e);p&&(t="duplicate",r=p)}I.value.push({address:e,status:t,reason:r}),O.value=""},He=l=>{I.value.splice(l,1)},Ie=l=>{l.key===","||l.key==="Enter"?(l.preventDefault(),be(O.value)):l.key==="Backspace"&&O.value===""&&I.value.length>0&&I.value.pop()},Ue=l=>{var r;l.preventDefault(),(((r=l.clipboardData)==null?void 0:r.getData("text"))||"").split(/[,;\s\n]+/).filter(p=>p.trim()).forEach(p=>{be(p)})},Re=()=>{O.value.trim()&&be(O.value)},ye=l=>{const e=se.value.indexOf(l);e>-1?se.value.splice(e,1):se.value.push(l)},ze=l=>{const e=G.value.findIndex(t=>t.name===l);if(e>-1){G.value.splice(e,1);const t=se.value.indexOf(l);t>-1&&se.value.splice(t,1)}o.value.email_group=G.value.map(t=>({email_group:t.name}))},Ne=l=>{Array.from(l.target.files||[]).forEach(t=>{if(t.size>xl){alert(`File "${t.name}" is too large. Maximum size is 10MB.`);return}if(W.value.some(p=>p.name===t.name&&p.size===t.size)){alert(`File "${t.name}" is already attached.`);return}W.value.push(t)}),ve.value&&(ve.value.value="")},Be=l=>{W.value.splice(l,1)},he=l=>{if(l===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(l)/Math.log(e));return Math.round(l/Math.pow(e,r)*100)/100+" "+t[r]},De=l=>l.type.startsWith("image/"),Fe=l=>l.type==="application/pdf"||l.name.toLowerCase().endsWith(".pdf"),Ve=Y(()=>W.value.reduce((l,e)=>l+e.size,0)),ue=()=>`temp-grp-${Math.random().toString(36).substring(2,8)}`,de=(l,e,t=!1)=>z(this,null,function*(){try{console.log(`Creating email group: ${l}`,e);const p=yield X("frappe.client.insert",{doc:{doctype:"Email Group",title:l}});console.log("Email Group created:",p);for(const $ of e){const j={doctype:"Email Group Member",email_group:p.name,email:$,unsubscribed:0};yield X("frappe.client.insert",{doc:j})}return console.log(`Added ${e.length} members to group ${l}`),{name:p.name,title:l,email_count:e.length,emails:e,isTemporary:t}}catch(r){throw console.error("Error creating email group:",r),new Error(`Failed to create email group: ${r.message||r}`)}}),xe=(l,e,t)=>{x.value=l,F.value=e,U.value=t,C.value="",y.value=!0,setTimeout(()=>{J.value&&J.value.focus()},100)},ne=()=>{y.value=!1,x.value=[],F.value="",U.value=null,C.value=""},Oe=()=>z(this,null,function*(){if(y.value=!1,U.value){const l=ue(),e=yield de(l,x.value,!0);U.value(e)}ne()}),we=()=>z(this,null,function*(){if(y.value=!1,U.value){const l=C.value.trim()||ue(),e=!C.value.trim(),t=yield de(l,x.value,e);U.value(t)}ne()}),o=_({sender_name:"",sender_email:"",send_from:"",email_group:[],subject:"",content_type:"Rich Text",message:"",message_md:"",message_html:"",send_unsubscribe_link:!0,send_webview_link:!1,published:!1,route:"",schedule_sending:!1,schedule_send:"",campaign:"",attachments:[]}),ce=Y(()=>I.value.filter(l=>l.status==="valid").length),Pe=Y(()=>I.value.filter(l=>l.status==="invalid").length),qe=Y(()=>I.value.filter(l=>l.status==="duplicate").length),re=Y(()=>{const l=G.value.reduce((t,r)=>t+(r.email_count||0),0),e=ce.value;return l+e});oe(()=>o.value.content_type,(l,e)=>{l!=="Rich Text"&&(o.value.message=""),l!=="Markdown"&&(o.value.message_md=""),l!=="HTML"&&(o.value.message_html="")}),oe(()=>o.value.message,l=>{i.value&&i.value.getHTML()!==l&&i.value.commands.setContent(l||"",!1)}),oe(m,l=>{o.value.schedule_sending=l,l||(o.value.schedule_send="")}),oe(()=>o.value.published,l=>{l&&o.value.subject&&!o.value.route?o.value.route=`newsletter/${o.value.subject.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}`:l||(o.value.route="")});const ae=()=>{L("close"),q.value=!1},We=()=>{const l=me.user||"Administrator";console.log("Resetting form for user:",l),console.log("Session object:",me);let e=l.includes("@")?l:`${l}@yourcompany.com`,t=l==="Administrator"?"System Administrator":l;console.log("Default sender email:",e),console.log("Default sender name:",t),o.value={sender_name:t,sender_email:e,send_from:t,email_group:[],subject:"",content_type:"Rich Text",message:"",message_md:"",message_html:"",send_unsubscribe_link:!0,send_webview_link:!1,published:!1,route:"",schedule_sending:!1,schedule_send:"",campaign:"",attachments:[]},console.log("Form initialized with sender_email:",o.value.sender_email),X("frappe.client.get",{doctype:"User",name:l}).then(r=>{if(console.log("Fetched user document:",r),r&&r.email){const p=r.email,$=r.full_name||r.first_name||l;console.log("Updating sender email to:",p),console.log("Updating sender name to:",$),o.value.sender_email=p,o.value.sender_name=$,o.value.send_from=$,console.log("Updated form sender_email:",o.value.sender_email)}else console.warn("User document missing email field, keeping default")}).catch(r=>{console.error("Error fetching user email:",r),console.log("Keeping default sender email:",o.value.sender_email)}),I.value=[],O.value="",G.value=[],se.value=[],m.value=!1,W.value=[],i.value&&i.value.commands.setContent("",!1)},Ke=l=>{G.value=l,o.value.email_group=l.map(e=>({email_group:e.name}))},Xe=()=>z(this,null,function*(){const l=e=>z(this,null,function*(){try{T.value=!0;const t={doctype:"Newsletter",subject:o.value.subject,sender_name:o.value.sender_name||me.user,sender_email:o.value.sender_email,send_from:o.value.send_from||`${o.value.sender_name} <${o.value.sender_email}>`,content_type:o.value.content_type,message:o.value.message||"",message_md:o.value.message_md||"",message_html:o.value.message_html||"",send_unsubscribe_link:o.value.send_unsubscribe_link?1:0,send_webview_link:o.value.send_webview_link?1:0,published:o.value.published?1:0,route:o.value.route||"",schedule_sending:o.value.schedule_sending?1:0,schedule_send:o.value.schedule_send||null,campaign:o.value.campaign||"",email_group:e.map(p=>({email_group:p.name}))};console.log("Saving Newsletter draft:",t);const r=yield X("frappe.client.insert",{doc:t});console.log("Newsletter saved:",r),L("email-sent",{type:"success",subject:r.subject,name:r.name,recipientCount:re.value,action:"draft_saved",message:`Newsletter draft "${r.subject}" saved successfully!`}),ae()}catch(t){console.error("Error saving newsletter:",t),L("email-sent",{type:"error",subject:o.value.subject,name:null,recipientCount:0,action:"draft_save_failed",message:`Failed to save newsletter: ${t.message||t}`})}finally{T.value=!1}});try{if(!o.value.subject)throw new Error("Subject is required");if(!o.value.sender_email)throw new Error("Sender Email is required");if(G.value.length===0&&ce.value===0)throw new Error("At least one email group or recipient is required");const e=I.value.filter(j=>j.status==="valid").map(j=>j.address),t=G.value.length>0,r=e.length>0;if(t&&!r){yield l(G.value);return}if(!t&&e.length===1){const j=ue(),R=yield de(j,e,!0);yield l([R]);return}let p=[...e],$="";t&&r?(G.value.forEach(j=>{j.emails&&p.push(...j.emails)}),p=[...new Set(p)],$="You have selected email groups and added individual emails. Would you like to save all recipients as a new group for future use?"):$="Would you like to save these recipients as a group for future use?",xe(p,$,j=>z(this,null,function*(){yield l(t?[j]:[j])}))}catch(e){console.error("Error in save draft:",e),alert(`Error: ${e.message||e}`),T.value=!1}}),Je=()=>z(this,null,function*(){const l=e=>z(this,null,function*(){try{S.value=!0;const t={doctype:"Newsletter",subject:o.value.subject,sender_name:o.value.sender_name||me.user,sender_email:o.value.sender_email,send_from:o.value.send_from||`${o.value.sender_name} <${o.value.sender_email}>`,content_type:o.value.content_type,message:o.value.message||"",message_md:o.value.message_md||"",message_html:o.value.message_html||"",send_unsubscribe_link:o.value.send_unsubscribe_link?1:0,send_webview_link:o.value.send_webview_link?1:0,published:o.value.published?1:0,route:o.value.route||"",schedule_sending:o.value.schedule_sending?1:0,schedule_send:o.value.schedule_send||null,campaign:o.value.campaign||"",email_group:e.map(p=>({email_group:p.name}))};console.log("Creating Newsletter:",t);let r;try{r=yield X("frappe.client.insert",{doc:t})}catch(p){if(p.message&&p.message.includes("DuplicateEntryError")){const $=Date.now();t.subject=`${o.value.subject} (${$})`,r=yield X("frappe.client.insert",{doc:t})}else throw p}console.log("Newsletter saved:",r),console.log("Email groups in newsletter:",e.map(p=>p.name));for(const p of e){console.log(`Checking members for group: ${p.name}`);try{const $=yield X("frappe.client.get_list",{doctype:"Email Group Member",fields:["email","email_group","unsubscribed"],filters:[["email_group","=",p.name]],limit_page_length:1e3});console.log(`Group ${p.name} has ${$.length} members:`,$)}catch($){console.error(`Error checking members for ${p.name}:`,$)}}o.value.schedule_sending&&o.value.schedule_send?L("email-sent",{type:"info",subject:r.subject,name:r.name,recipientCount:re.value,scheduled:!0,action:"scheduled",message:`Newsletter "${r.subject}" scheduled to send at ${o.value.schedule_send}`}):(console.log("Sending newsletter:",r.name),yield X("run_doc_method",{docs:r,method:"send_emails"}),L("email-sent",{type:"success",subject:r.subject,name:r.name,recipientCount:re.value,scheduled:!1,action:"sent",message:`Newsletter "${r.subject}" has been queued for sending to ${re.value} recipients!`})),ae()}catch(t){console.error("Error sending newsletter:",t),L("email-sent",{type:"error",subject:o.value.subject,name:null,recipientCount:0,scheduled:!1,action:"send_failed",message:`Failed to send newsletter: ${t.message||t}`})}finally{S.value=!1}});try{if(!o.value.subject)throw new Error("Subject is required");if(!o.value.sender_email)throw console.error("Sender email is missing! Current formData:",o.value),new Error("Sender Email is required");console.log("Sending email with sender:",o.value.sender_email);const e={"Rich Text":"message",Markdown:"message_md",HTML:"message_html"}[o.value.content_type];if(!o.value[e])throw new Error("Message content is required");if(G.value.length===0&&ce.value===0)throw new Error("At least one email group or recipient is required");const t=I.value.filter(R=>R.status==="valid").map(R=>R.address),r=G.value.length>0,p=t.length>0;if(r&&!p){yield l(G.value);return}if(!r&&t.length===1){const R=ue(),_e=yield de(R,t,!0);yield l([_e]);return}let $=[...t],j="";r&&p?(G.value.forEach(R=>{R.emails&&$.push(...R.emails)}),$=[...new Set($)],j="You have selected email groups and added individual emails. Would you like to save all recipients as a new group for future use?"):j="Would you like to save these recipients as a group for future use?",xe($,j,R=>z(this,null,function*(){yield l(r?[R]:[R])}))}catch(e){console.error("Error in send email:",e),alert(`Error: ${e.message||e}`),S.value=!1}});return oe(()=>h.show,l=>{l&&We()}),vt(()=>{i.value&&i.value.destroy()}),(l,e)=>(v(),b(Z,null,[q.value?(v(),b("div",ls,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:ae}),s("div",os,[s("div",ns,[e[42]||(e[42]=s("h2",{class:"text-lg font-semibold text-gray-900"},"Compose Email",-1)),s("button",{onClick:ae,class:"text-gray-400 hover:text-gray-600"},[k(a(D),{name:"x",class:"w-5 h-5"})])]),s("div",rs,[s("div",as,[s("div",null,[e[44]||(e[44]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[H("Recipients "),s("span",{class:"text-red-500"},"*")],-1)),s("div",is,[s("div",us,[s("div",ds,[s("div",cs,[(v(!0),b(Z,null,le(G.value,t=>(v(),b("div",{key:"group-"+t.name,class:"relative group"},[s("div",{class:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm cursor-pointer hover:bg-blue-200 transition-colors",onClick:r=>ye(t.name)},[k(a(D),{name:"users",class:"w-3 h-3"}),s("span",ps,w(t.title||t.name),1),s("span",gs,"("+w(t.email_count||0)+")",1),s("button",{type:"button",onClick:Te(r=>ze(t.name),["stop"]),class:"ml-1 hover:bg-blue-300 rounded-full p-0.5"},[k(a(D),{name:"x",class:"w-3 h-3"})],8,vs)],8,ms),se.value.includes(t.name)?(v(),b("div",bs,[s("div",fs,[s("h4",ys,w(t.title||t.name)+" Members",1),s("button",{type:"button",onClick:r=>ye(t.name),class:"text-gray-400 hover:text-gray-600"},[k(a(D),{name:"x",class:"w-4 h-4"})],8,hs)]),s("div",xs,[(v(!0),b(Z,null,le(t.emails||[],(r,p)=>(v(),b("div",{key:p,class:"text-xs text-gray-600 py-1 px-2 bg-gray-50 rounded"},w(r),1))),128)),!t.emails||t.emails.length===0?(v(),b("div",ws," No members loaded ")):M("",!0)])])):M("",!0)]))),128)),(v(!0),b(Z,null,le(I.value,(t,r)=>(v(),b("div",{key:"email-"+r,class:E(["inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm relative group",t.status==="valid"?"bg-green-100 text-green-800":t.status==="invalid"?"bg-red-100 text-red-800":t.status==="duplicate"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"]),title:t.reason||""},[t.status==="invalid"?(v(),b("span",ks,"âš ï¸")):M("",!0),t.status==="duplicate"?(v(),b("span",Cs,"âš ")):M("",!0),t.status==="valid"?(v(),b("span",$s,"âœ“")):M("",!0),s("span",null,w(t.address),1),s("button",{type:"button",onClick:p=>He(r),class:E(["hover:bg-opacity-50 rounded-full p-0.5",t.status==="valid"?"hover:bg-green-300":t.status==="invalid"?"hover:bg-red-300":t.status==="duplicate"?"hover:bg-yellow-300":"hover:bg-gray-300"])},[k(a(D),{name:"x",class:"w-3 h-3"})],10,Es),t.reason?(v(),b("div",{key:3,class:E(["absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-xs text-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-30",[t.status==="invalid"?"bg-red-600":t.status==="duplicate"?"bg-yellow-600":"bg-gray-600"]])},[H(w(t.reason)+" ",1),s("div",{class:E(["absolute top-full left-1/2 -translate-x-1/2 -mt-1 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent",[t.status==="invalid"?"border-t-red-600":t.status==="duplicate"?"border-t-yellow-600":"border-t-gray-600"]])},null,2)],2)):M("",!0)],10,_s))),128))]),N(s("input",{ref_key:"recipientInput",ref:ge,"onUpdate:modelValue":e[0]||(e[0]=t=>O.value=t),onKeydown:Ie,onPaste:Ue,onBlur:Re,type:"text",placeholder:"Type email and press comma or enter...",class:"w-full outline-none text-sm"},null,544),[[P,O.value]])])]),k(a(K),{onClick:e[1]||(e[1]=t=>f.value=!0),variant:"outline",size:"sm",class:"mt-1"},{prefix:B(()=>[k(a(D),{name:"users",class:"w-4 h-4"})]),default:B(()=>[e[43]||(e[43]=H(" Select Group "))]),_:1,__:[43]})]),s("p",As," Total Recipients: "+w(re.value)+" ("+w(ce.value)+" valid, "+w(Pe.value)+" invalid, "+w(qe.value)+" duplicates) ",1)]),s("div",null,[e[45]||(e[45]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[H("Subject "),s("span",{class:"text-red-500"},"*")],-1)),N(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.subject=t),type:"text",placeholder:"Enter email subject",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[P,o.value.subject]])]),s("div",null,[e[47]||(e[47]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Content Type",-1)),N(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.content_type=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},e[46]||(e[46]=[s("option",{value:"Rich Text"},"Rich Text",-1),s("option",{value:"Markdown"},"Markdown",-1),s("option",{value:"HTML"},"HTML",-1)]),512),[[bt,o.value.content_type]])]),s("div",null,[e[54]||(e[54]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[H("Message "),s("span",{class:"text-red-500"},"*")],-1)),o.value.content_type==="Rich Text"?(v(),b("div",Ms,[a(i)?(v(),b("div",Ss,[s("div",Ts,[s("button",{type:"button",onClick:e[4]||(e[4]=t=>a(i).chain().focus().toggleBold().run()),class:E([{"bg-gray-200":a(i).isActive("bold")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Bold (Ctrl+B)"}," B ",2),s("button",{type:"button",onClick:e[5]||(e[5]=t=>a(i).chain().focus().toggleItalic().run()),class:E([{"bg-gray-200":a(i).isActive("italic")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 italic"]),title:"Italic (Ctrl+I)"}," I ",2),s("button",{type:"button",onClick:e[6]||(e[6]=t=>a(i).chain().focus().toggleUnderline().run()),class:E([{"bg-gray-200":a(i).isActive("underline")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 underline"]),title:"Underline (Ctrl+U)"}," U ",2),s("button",{type:"button",onClick:e[7]||(e[7]=t=>a(i).chain().focus().toggleStrike().run()),class:E([{"bg-gray-200":a(i).isActive("strike")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 line-through"]),title:"Strikethrough"}," S ",2),e[49]||(e[49]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("div",Ls,[s("button",{type:"button",onClick:e[8]||(e[8]=t=>d.value=!d.value),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 flex items-center gap-1",title:"Text Color"},e[48]||(e[48]=[H(" A "),s("span",{class:"w-4 h-1 bg-current"},null,-1)])),d.value?(v(),b("div",js,[N(s("input",{type:"color","onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),onChange:e[10]||(e[10]=t=>te(g.value)),class:"w-20 h-8"},null,544),[[P,g.value]]),s("button",{onClick:e[11]||(e[11]=t=>{a(i).chain().focus().unsetColor().run(),d.value=!1}),class:"mt-1 px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200 w-full"}," Clear ")])):M("",!0)]),s("div",Gs,[s("button",{type:"button",onClick:e[12]||(e[12]=t=>u.value=!u.value),class:E([{"bg-gray-200":a(i).isActive("highlight")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Highlight"}," ðŸŽ¨ ",2),u.value?(v(),b("div",Hs,[N(s("input",{type:"color","onUpdate:modelValue":e[13]||(e[13]=t=>V.value=t),onChange:e[14]||(e[14]=t=>ie(V.value)),class:"w-20 h-8"},null,544),[[P,V.value]]),s("button",{onClick:e[15]||(e[15]=t=>{a(i).chain().focus().unsetHighlight().run(),u.value=!1}),class:"mt-1 px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200 w-full"}," Clear ")])):M("",!0)])]),s("div",Is,[s("button",{type:"button",onClick:e[16]||(e[16]=t=>a(i).chain().focus().toggleHeading({level:1}).run()),class:E([{"bg-gray-200":a(i).isActive("heading",{level:1})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Heading 1"}," H1 ",2),s("button",{type:"button",onClick:e[17]||(e[17]=t=>a(i).chain().focus().toggleHeading({level:2}).run()),class:E([{"bg-gray-200":a(i).isActive("heading",{level:2})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Heading 2"}," H2 ",2),s("button",{type:"button",onClick:e[18]||(e[18]=t=>a(i).chain().focus().toggleHeading({level:3}).run()),class:E([{"bg-gray-200":a(i).isActive("heading",{level:3})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-bold"]),title:"Heading 3"}," H3 ",2),s("button",{type:"button",onClick:e[19]||(e[19]=t=>a(i).chain().focus().setParagraph().run()),class:E([{"bg-gray-200":a(i).isActive("paragraph")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Paragraph"}," P ",2),e[50]||(e[50]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[20]||(e[20]=t=>a(i).chain().focus().setTextAlign("left").run()),class:E([{"bg-gray-200":a(i).isActive({textAlign:"left"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Align Left"}," â«· ",2),s("button",{type:"button",onClick:e[21]||(e[21]=t=>a(i).chain().focus().setTextAlign("center").run()),class:E([{"bg-gray-200":a(i).isActive({textAlign:"center"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Align Center"}," â‰¡ ",2),s("button",{type:"button",onClick:e[22]||(e[22]=t=>a(i).chain().focus().setTextAlign("right").run()),class:E([{"bg-gray-200":a(i).isActive({textAlign:"right"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Align Right"}," â«¸ ",2),s("button",{type:"button",onClick:e[23]||(e[23]=t=>a(i).chain().focus().setTextAlign("justify").run()),class:E([{"bg-gray-200":a(i).isActive({textAlign:"justify"})},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Justify"}," â–¤ ",2)]),s("div",Us,[s("button",{type:"button",onClick:e[24]||(e[24]=t=>a(i).chain().focus().toggleBulletList().run()),class:E([{"bg-gray-200":a(i).isActive("bulletList")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Bullet List"}," â€¢ ",2),s("button",{type:"button",onClick:e[25]||(e[25]=t=>a(i).chain().focus().toggleOrderedList().run()),class:E([{"bg-gray-200":a(i).isActive("orderedList")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Numbered List"}," 1. ",2),s("button",{type:"button",onClick:e[26]||(e[26]=t=>a(i).chain().focus().toggleBlockquote().run()),class:E([{"bg-gray-200":a(i).isActive("blockquote")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100"]),title:"Quote"},' " ',2),s("button",{type:"button",onClick:e[27]||(e[27]=t=>a(i).chain().focus().toggleCodeBlock().run()),class:E([{"bg-gray-200":a(i).isActive("codeBlock")},"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 font-mono"]),title:"Code Block"}," </> ",2),e[51]||(e[51]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[28]||(e[28]=t=>l.$refs.imageInput.click()),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Upload Image"}," ðŸ“· "),s("input",{ref_key:"imageInput",ref:ee,type:"file",accept:"image/*",onChange:A,class:"hidden"},null,544),s("button",{type:"button",onClick:Q,class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Insert Image URL"}," ðŸ–¼ï¸ "),s("button",{type:"button",onClick:pe,class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Insert Table"}," âŠž "),e[52]||(e[52]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[29]||(e[29]=t=>a(i).chain().focus().setHorizontalRule().run()),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100",title:"Horizontal Line"}," â€” "),e[53]||(e[53]=s("div",{class:"border-l border-gray-300 mx-1"},null,-1)),s("button",{type:"button",onClick:e[30]||(e[30]=t=>a(i).chain().focus().undo().run()),disabled:!a(i).can().undo(),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Undo"}," â†¶ ",8,Rs),s("button",{type:"button",onClick:e[31]||(e[31]=t=>a(i).chain().focus().redo().run()),disabled:!a(i).can().redo(),class:"px-3 py-1 text-sm border border-gray-200 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Redo"}," â†· ",8,zs)])])):M("",!0),k(a(ft),{editor:a(i),class:"tiptap-editor"},null,8,["editor"])])):o.value.content_type==="Markdown"?(v(),b("div",Ns,[N(s("textarea",{"onUpdate:modelValue":e[32]||(e[32]=t=>o.value.message_md=t),placeholder:"Compose your email message in Markdown...",rows:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"},null,512),[[P,o.value.message_md]])])):o.value.content_type==="HTML"?(v(),b("div",Bs,[N(s("textarea",{"onUpdate:modelValue":e[33]||(e[33]=t=>o.value.message_html=t),placeholder:"Compose your email message in HTML...",rows:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"},null,512),[[P,o.value.message_html]])])):M("",!0)]),s("div",null,[e[60]||(e[60]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Attachments",-1)),s("div",Ds,[W.value.length>0?(v(),b("div",Fs,[(v(!0),b(Z,null,le(W.value,(t,r)=>(v(),b("div",{key:"attachment-"+r,class:"inline-flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors"},[s("div",Vs,[De(t)?(v(),b("svg",Os,e[55]||(e[55]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):Fe(t)?(v(),b("svg",Ps,e[56]||(e[56]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(v(),b("svg",qs,e[57]||(e[57]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])))]),s("div",Ws,[s("div",Ks,w(t.name),1),s("div",Xs,w(he(t.size)),1)]),s("button",{type:"button",onClick:p=>Be(r),class:"flex-shrink-0 text-gray-400 hover:text-red-600 transition-colors",title:"Remove attachment"},[k(a(D),{name:"x",class:"w-4 h-4"})],8,Js)]))),128))])):M("",!0),s("div",Qs,[s("input",{ref_key:"attachmentInput",ref:ve,type:"file",multiple:"",onChange:Ne,class:"hidden"},null,544),k(a(K),{onClick:e[34]||(e[34]=t=>l.$refs.attachmentInput.click()),variant:"outline",size:"sm"},{prefix:B(()=>[k(a(D),{name:"paperclip",class:"w-4 h-4"})]),default:B(()=>[e[58]||(e[58]=H(" Add Attachments "))]),_:1,__:[58]}),W.value.length>0?(v(),b("span",Ys,w(W.value.length)+" file"+w(W.value.length!==1?"s":"")+" ("+w(he(Ve.value))+") ",1)):M("",!0)]),e[59]||(e[59]=s("p",{class:"text-xs text-gray-500 mt-2"}," Maximum file size: 10MB per file. Supported formats: All common file types. ",-1))])]),s("div",Zs,[e[64]||(e[64]=s("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Email Options",-1)),s("div",el,[s("div",tl,[s("label",sl,[N(s("input",{type:"checkbox","onUpdate:modelValue":e[35]||(e[35]=t=>o.value.send_unsubscribe_link=t),class:"mr-2"},null,512),[[Ae,o.value.send_unsubscribe_link]]),e[61]||(e[61]=s("span",{class:"text-sm text-gray-700"},"Send Unsubscribe Link",-1))])]),s("div",ll,[s("label",ol,[N(s("input",{type:"checkbox","onUpdate:modelValue":e[36]||(e[36]=t=>m.value=t),class:"mr-2"},null,512),[[Ae,m.value]]),e[62]||(e[62]=s("span",{class:"text-sm text-gray-700"},"Schedule sending at a later time",-1))]),m.value?(v(),b("div",nl,[e[63]||(e[63]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Send Email At",-1)),N(s("input",{"onUpdate:modelValue":e[37]||(e[37]=t=>o.value.schedule_send=t),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,o.value.schedule_send]])])):M("",!0)])])]),s("div",rl,[s("div",null,[e[65]||(e[65]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Campaign (Optional)",-1)),N(s("input",{"onUpdate:modelValue":e[38]||(e[38]=t=>o.value.campaign=t),type:"text",placeholder:"Enter campaign name",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,o.value.campaign]])]),o.value.published?(v(),b("div",al,[e[66]||(e[66]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Route",-1)),N(s("input",{"onUpdate:modelValue":e[39]||(e[39]=t=>o.value.route=t),type:"text",placeholder:"e.g., newsletter/my-newsletter",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,o.value.route]])])):M("",!0)])])]),s("div",il,[k(a(K),{onClick:ae,variant:"outline"},{default:B(()=>e[67]||(e[67]=[H(" Cancel ")])),_:1,__:[67]}),s("div",ul,[k(a(K),{onClick:Xe,variant:"outline",loading:T.value},{prefix:B(()=>[k(a(D),{name:"save",class:"w-4 h-4"})]),default:B(()=>[e[68]||(e[68]=H(" Save Draft "))]),_:1,__:[68]},8,["loading"]),k(a(K),{onClick:Je,variant:"solid",loading:S.value},{default:B(()=>[H(w(m.value?"Schedule Email":"Send Email"),1)]),_:1},8,["loading"])])])])])):M("",!0),k(ss,{show:f.value,"onUpdate:show":e[40]||(e[40]=t=>f.value=t),onGroupsSelected:Ke},null,8,["show"]),y.value?(v(),b("div",dl,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:ne}),s("div",cl,[s("div",ml,[e[69]||(e[69]=s("h2",{class:"text-lg font-semibold text-gray-900"},"Save Email Group",-1)),s("button",{onClick:ne,class:"text-gray-400 hover:text-gray-600"},[k(a(D),{name:"x",class:"w-5 h-5"})])]),s("div",pl,[s("p",gl,w(F.value),1),s("div",vl,[e[70]||(e[70]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Group Name (Optional) ",-1)),N(s("input",{ref_key:"groupNameInput",ref:J,"onUpdate:modelValue":e[41]||(e[41]=t=>C.value=t),type:"text",placeholder:"e.g., Marketing Team",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeydown:yt(we,["enter"])},null,544),[[P,C.value]]),e[71]||(e[71]=s("p",{class:"text-xs text-gray-500 mt-1"}," Leave empty to create a temporary group ",-1))]),s("div",bl,[e[72]||(e[72]=s("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Recipients to be saved:",-1)),s("div",fl,[(v(!0),b(Z,null,le(x.value,t=>(v(),b("div",{key:t,class:"py-1"},w(t),1))),128))]),s("div",yl," Total: "+w(x.value.length)+" recipients ",1)])]),s("div",hl,[k(a(K),{onClick:ne,variant:"outline"},{default:B(()=>e[73]||(e[73]=[H(" Cancel ")])),_:1,__:[73]}),k(a(K),{onClick:Oe,variant:"outline"},{default:B(()=>e[74]||(e[74]=[H(" Skip (Create Temporary) ")])),_:1,__:[74]}),k(a(K),{onClick:we,variant:"solid"},{default:B(()=>[H(w(C.value?"Save Group":"Continue"),1)]),_:1})])])])):M("",!0)],64))}};export{kl as _,X as c};
//# sourceMappingURL=ComposeEmailDialog-Dajqmh4R.js.map
