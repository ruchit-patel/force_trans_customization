var z=(U,_,v)=>new Promise((m,p)=>{var f=i=>{try{g(v.next(i))}catch(b){p(b)}},r=i=>{try{g(v.throw(i))}catch(b){p(b)}},g=i=>i.done?m(i.value):Promise.resolve(i.value).then(f,r);g((v=v.apply(U,_)).next())});import{r as h,c as $,G as le,aF as oe,y as u,o as d,ag as t,q as o,n as c,ae as x,s as n,ak as w,ao as C,af as l,aJ as P,z as D,l as ne,ay as T,az as ie,aB as A,aA as re,aK as de,F as Y,A as I,ad as R}from"./index-D6neGqae.js";import{_ as ue,c as L}from"./ComposeEmailDialog-Bj9SiQLI.js";const ce={class:"min-h-screen bg-gray-50"},me={class:"bg-white shadow-sm border-b"},pe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},xe={class:"flex justify-between items-center py-4"},ve={class:"flex items-center space-x-4"},ge={class:"flex space-x-4"},fe={class:"flex items-center space-x-4"},ye={class:"text-sm text-gray-600"},he={class:"bg-white border-b border-gray-200"},_e={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},be={class:"flex items-center justify-between"},we={class:"bg-white border-b border-gray-200"},ke={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Se={class:"flex items-center gap-4"},Ce={class:"flex-1 max-w-md"},De={class:"relative"},$e={class:"w-48"},Te={class:"w-48"},Ve={key:0,class:"mt-3 flex items-center gap-2 text-sm text-gray-600"},Fe={key:0,class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded"},Ne={key:1,class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded"},Me={key:2,class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded"},je={class:"text-gray-500"},Ee={key:0,class:"flex items-center justify-center flex-1"},ze={class:"text-center"},Ae={key:1,class:"flex items-center justify-center flex-1"},Le={class:"text-center max-w-md"},Ue={class:"text-gray-500 mb-6"},Be={key:2,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Pe={class:"bg-white rounded-lg shadow overflow-hidden"},Ye={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-white divide-y divide-gray-200"},Re={class:"px-6 py-4"},We={class:"flex items-center"},qe={class:"text-sm font-medium text-gray-900"},Ge={class:"text-xs text-gray-500"},Je={class:"px-6 py-4 whitespace-nowrap"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Oe={class:"px-6 py-4 whitespace-nowrap"},Qe={class:"text-sm text-gray-900"},He={class:"text-xs text-gray-500"},Xe={class:"px-6 py-4 whitespace-nowrap"},Ze={class:"text-sm text-gray-900"},et={class:"text-xs text-gray-500"},tt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},st=["onClick"],at=["onClick"],lt={class:"mt-4 flex items-center justify-between bg-white px-6 py-3 rounded-lg shadow"},ot={class:"flex items-center gap-4"},nt={class:"text-sm text-gray-700"},it={class:"font-medium"},rt={class:"font-medium"},dt={class:"font-medium"},ut={class:"flex items-center gap-2"},ct={class:"flex items-center gap-1"},mt=["onClick"],gt={__name:"SentEmails",setup(U){const _=h([]),v=h(!1),m=h(""),p=h("all"),f=h("all"),r=h(1),g=h(20),i=h(0),b=h(!1);let V=null;const F=$(()=>p.value!=="all"||f.value!=="all"||m.value!==""),N=$(()=>Math.ceil(i.value/g.value)),M=$(()=>(r.value-1)*g.value),W=$(()=>Math.min(M.value+g.value,i.value)),q=$(()=>{const s=[];let y=Math.max(1,r.value-Math.floor(2.5)),a=Math.min(N.value,y+5-1);a-y+1<5&&(y=Math.max(1,a-5+1));for(let S=y;S<=a;S++)s.push(S);return s}),G=()=>{const s=new Date;let e=null;switch(f.value){case"today":e=new Date(s.getFullYear(),s.getMonth(),s.getDate());break;case"week":e=new Date(s.getFullYear(),s.getMonth(),s.getDate()-7);break;case"month":e=new Date(s.getFullYear(),s.getMonth(),1);break;case"year":e=new Date(s.getFullYear(),0,1);break}return e?e.toISOString().split("T")[0]+" 00:00:00":null},J=()=>{const s=[];p.value==="sent"?s.push(["email_sent","=",1]):p.value==="scheduled"?(s.push(["schedule_sending","=",1]),s.push(["email_sent","=",0])):p.value==="draft"&&(s.push(["email_sent","=",0]),s.push(["schedule_sending","=",0]));const e=G();return e&&s.push(["modified",">=",e]),m.value&&s.push([["subject","like",`%${m.value}%`],"or",["sender_name","like",`%${m.value}%`],"or",["sender_email","like",`%${m.value}%`]]),s},k=()=>z(this,null,function*(){v.value=!0;try{console.log("Loading newsletters with filters...");const s=J(),e=yield L("frappe.client.get_list",{doctype:"Newsletter",fields:["name","subject","sender_name","sender_email","email_sent","email_sent_at","schedule_sending","schedule_send","total_recipients","total_views","modified","owner"],filters:s,order_by:"modified desc",limit_start:M.value,limit_page_length:g.value}),y=yield L("frappe.client.get_count",{doctype:"Newsletter",filters:s});_.value=e||[],i.value=y||0,console.log(`Loaded ${_.value.length} newsletters (${i.value} total)`)}catch(s){console.error("Error loading newsletters:",s),_.value=[],i.value=0}finally{v.value=!1}}),B=()=>{r.value=1,k()},j=()=>{r.value=1,k()},K=()=>{V&&clearTimeout(V),V=setTimeout(()=>{j()},500)},O=()=>{m.value="",p.value="all",f.value="all",r.value=1,k()},E=s=>{s>=1&&s<=N.value&&(r.value=s,k())},Q=()=>{r.value=1,k()},H=s=>s.email_sent?"Sent":s.schedule_sending?"Scheduled":"Draft",X=s=>s.email_sent?"bg-green-100 text-green-800":s.schedule_sending?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800",Z=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",ee=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",te=s=>{window.open(`/app/newsletter/${s.name}`,"_blank")},se=s=>z(this,null,function*(){if(confirm(`Are you sure you want to delete "${s.subject}"?`))try{yield L("frappe.client.delete",{doctype:"Newsletter",name:s.name}),k(),console.log(`Deleted newsletter: ${s.name}`)}catch(e){console.error("Error deleting newsletter:",e),alert(`Failed to delete newsletter: ${e.message||e}`)}}),ae=s=>{b.value=!1,B()};return le(()=>{k()}),(s,e)=>{const y=oe("router-link");return d(),u("div",ce,[t("div",me,[t("div",pe,[t("div",xe,[t("div",ve,[e[13]||(e[13]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Ticket Tracker",-1)),t("nav",ge,[o(y,{to:"/",class:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium","active-class":"bg-blue-100 text-blue-700","inactive-class":"text-gray-600 hover:text-gray-900"},{default:c(()=>[...e[9]||(e[9]=[x(" Tickets ",-1)])]),_:1}),o(y,{to:"/sent-emails",class:"bg-blue-100 text-blue-700 px-3 py-2 rounded-md text-sm font-medium","active-class":"bg-blue-100 text-blue-700","inactive-class":"text-gray-600 hover:text-gray-900"},{default:c(()=>[...e[10]||(e[10]=[x(" Sent Emails ",-1)])]),_:1}),e[11]||(e[11]=t("a",{href:"/app/support",class:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium"}," Desk ",-1)),e[12]||(e[12]=t("a",{href:"/intro",class:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium"}," Wiki ",-1))])]),t("div",fe,[o(n(C),{onClick:e[0]||(e[0]=a=>b.value=!0),variant:"solid",size:"sm"},{prefix:c(()=>[o(n(w),{name:"mail",class:"w-4 h-4"})]),default:c(()=>[e[14]||(e[14]=x(" Compose Email ",-1))]),_:1}),t("span",ye,l(n(P).user),1),o(n(C),{onClick:e[1]||(e[1]=a=>n(P).logout.submit()),variant:"outline",size:"sm"},{default:c(()=>[...e[15]||(e[15]=[x(" Logout ",-1)])]),_:1})])])])]),t("div",he,[t("div",_e,[t("div",be,[e[17]||(e[17]=t("div",null,[t("h2",{class:"text-2xl font-semibold text-gray-900"},"Sent Emails"),t("p",{class:"text-sm text-gray-500 mt-1"},"View all newsletters sent, scheduled, or saved as drafts")],-1)),o(n(C),{onClick:B,loading:v.value},{prefix:c(()=>[o(n(w),{name:"refresh-cw",class:"w-4 h-4"})]),default:c(()=>[e[16]||(e[16]=x(" Refresh ",-1))]),_:1},8,["loading"])])])]),t("div",we,[t("div",ke,[t("div",Se,[t("div",Ce,[t("div",De,[o(n(w),{name:"search",class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),T(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),type:"text",placeholder:"Search by subject or sender...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:K},null,544),[[ie,m.value]])])]),t("div",$e,[T(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a),onChange:j,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...e[18]||(e[18]=[t("option",{value:"all"},"All Status",-1),t("option",{value:"sent"},"Sent",-1),t("option",{value:"scheduled"},"Scheduled",-1),t("option",{value:"draft"},"Draft",-1)])],544),[[A,p.value]])]),t("div",Te,[T(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),onChange:j,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...e[19]||(e[19]=[re('<option value="all">All Time</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option><option value="year">This Year</option>',5)])],544),[[A,f.value]])]),F.value?(d(),ne(n(C),{key:0,onClick:O,variant:"ghost"},{prefix:c(()=>[o(n(w),{name:"x",class:"w-4 h-4"})]),default:c(()=>[e[20]||(e[20]=x(" Clear ",-1))]),_:1})):D("",!0)]),F.value?(d(),u("div",Ve,[e[21]||(e[21]=t("span",{class:"font-medium"},"Active filters:",-1)),p.value!=="all"?(d(),u("span",Fe," Status: "+l(p.value),1)):D("",!0),f.value!=="all"?(d(),u("span",Ne," Date: "+l(f.value),1)):D("",!0),m.value?(d(),u("span",Me,' Search: "'+l(m.value)+'" ',1)):D("",!0),t("span",je,l(i.value)+" results",1)])):D("",!0)])]),v.value&&_.value.length===0?(d(),u("div",Ee,[t("div",ze,[o(n(de),{class:"w-8 h-8 mx-auto mb-4"}),e[22]||(e[22]=t("p",{class:"text-gray-500"},"Loading newsletters...",-1))])])):!v.value&&_.value.length===0?(d(),u("div",Ae,[t("div",Le,[o(n(w),{name:"mail",class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No newsletters found",-1)),t("p",Ue,l(F.value?"No newsletters match your filters. Try adjusting your search.":"You haven't sent any newsletters yet. Create one from the Issues page."),1)])])):(d(),u("div",Be,[t("div",null,[t("div",Pe,[t("table",Ye,[e[24]||(e[24]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Subject "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Recipients "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Sent By "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",Ie,[(d(!0),u(Y,null,I(_.value,a=>(d(),u("tr",{key:a.name,class:"hover:bg-gray-50"},[t("td",Re,[t("div",We,[o(n(w),{name:"mail",class:"w-4 h-4 text-gray-400 mr-3"}),t("div",null,[t("div",qe,l(a.subject),1),t("div",Ge,l(a.name),1)])])]),t("td",Je,[t("span",{class:R([X(a),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},l(H(a)),3)]),t("td",Ke,l(a.total_recipients||0),1),t("td",Oe,[t("div",Qe,l(a.sender_name||"Unknown"),1),t("div",He,l(a.sender_email),1)]),t("td",Xe,[t("div",Ze,l(Z(a.email_sent_at||a.schedule_send||a.modified)),1),t("div",et,l(ee(a.email_sent_at||a.schedule_send||a.modified)),1)]),t("td",tt,[t("button",{onClick:S=>te(a),class:"text-blue-600 hover:text-blue-900 mr-4"}," View ",8,st),a.email_sent?D("",!0):(d(),u("button",{key:0,onClick:S=>se(a),class:"text-red-600 hover:text-red-900"}," Delete ",8,at))])]))),128))])])]),t("div",lt,[t("div",ot,[t("span",nt,[e[25]||(e[25]=x(" Showing ",-1)),t("span",it,l(M.value+1),1),e[26]||(e[26]=x(" to ",-1)),t("span",rt,l(W.value),1),e[27]||(e[27]=x(" of ",-1)),t("span",dt,l(i.value),1),e[28]||(e[28]=x(" results ",-1))]),T(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),onChange:Q,class:"border border-gray-300 rounded px-2 py-1 text-sm"},[...e[29]||(e[29]=[t("option",{value:10},"10 per page",-1),t("option",{value:20},"20 per page",-1),t("option",{value:50},"50 per page",-1),t("option",{value:100},"100 per page",-1)])],544),[[A,g.value]])]),t("div",ut,[o(n(C),{onClick:e[6]||(e[6]=a=>E(r.value-1)),disabled:r.value===1,variant:"ghost",size:"sm"},{prefix:c(()=>[o(n(w),{name:"chevron-left",class:"w-4 h-4"})]),default:c(()=>[e[30]||(e[30]=x(" Previous ",-1))]),_:1},8,["disabled"]),t("div",ct,[(d(!0),u(Y,null,I(q.value,a=>(d(),u("button",{key:a,onClick:S=>E(a),class:R(["px-3 py-1 text-sm rounded",a===r.value?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"])},l(a),11,mt))),128))]),o(n(C),{onClick:e[7]||(e[7]=a=>E(r.value+1)),disabled:r.value===N.value,variant:"ghost",size:"sm"},{suffix:c(()=>[o(n(w),{name:"chevron-right",class:"w-4 h-4"})]),default:c(()=>[e[31]||(e[31]=x(" Next ",-1))]),_:1},8,["disabled"])])])])])),o(ue,{show:b.value,"onUpdate:show":e[8]||(e[8]=a=>b.value=a),onEmailSent:ae},null,8,["show"])])}}};export{gt as default};
//# sourceMappingURL=SentEmails-uOff0fWi.js.map
